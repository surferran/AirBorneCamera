window.Ibles.JST=window.Ibles.JST||{};var template=function(str){var fn=new Function("obj","var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+str.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(match,code){return"',"+code.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(match,code){return"');"+code.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');");return fn};window.Ibles.JST["vote-menu"]='<div class="dropdown-menu pull-right">\n    <h3>Contest Entry in:</h3>\n    <ul class="unstyled contests-entered">\n        <[ _.each(contests, function(contest){ ]>        \n        <li data-contestid="<< contest.id >>">\n            <div class="contest-entry clearfix">\n                <a title="<< contest.title >>" class="contest-image" href="<< contest.url >>">\n                    <img src="<< contest.thumbUrl >>" alt="<< contest.title >>"/>\n                </a>\n                <p>\n                    Is this a winner? <br/>\n                    <a class="btn btn-small vote-toggle-btn <[if (contest.votedFor){]>active<[}]>" data-votetxt="Vote" data-undotxt="Undo" data-loadingtxt="Loading...">\n                        <i class="icon icon-checkmark1"></i>&nbsp;\n                        <span class=\'vote-text\'>Vote</span>\n                    </a>\n                </p>\n            </div>\n        </li>\n        <[ }); ]>        \n    </ul> \n</div>';window.Ibles.JST["featured-by"]='<p class="subtle-txt">featured by: <a href="<< Ibles.reverseUrls.memberUrl(featuredBy) >>"><< featuredBy >> </a></p>';window.Ibles.JST["posted-date"]='<p><strong>Posted:</strong><br/><span class="subtle-txt"><< moment(publishDate).format("MMM DD, YYYY") >></span></p>';window.Ibles.JST["share-menu"]='<li><a class="facebook-share-button"><i class="facebook-icon share-icon"></i> Facebook</a></li>\n<li><a href="https://twitter.com/intent/tweet?text=<< title >>&url=<< fullUrl >>" target="_blank"><i class="twitter-icon share-icon"></i> Twitter</a></li>\n<li><a class="google-share-button" href="https://plus.google.com/share?url=<< fullUrl >>"><i class="googleplus-icon share-icon"></i> Google+</a></li>\n<li><a href="http://www.tumblr.com/share?url=<< fullUrl >>"  target="_blank"><i class="tumblr-icon share-icon"></i> Tumblr</a></li>\n<li><a href="mailto:?subject=<< title >>&amp;body=<< fullUrl >>" target="" title="Share via Email"><i class="email-icon share-icon"></i> Email</a></li>';window.Ibles.JST["social-share-overlay"]='<div class="social-share-overlay">\n    <a class="share-overlay-btn pinterest-share-btn"><i class="share-icon icon-pinterest"></i></a>\n    <a class="share-overlay-btn facebook-share-btn"><i class="share-icon icon-facebook"></i></a>\n    <a class="share-overlay-btn twitter-share-btn"><i class="share-icon icon-twitter"></i></a>\n    <a class="share-overlay-btn link-share-btn"><i class="share-icon icon-link"></i></a>\n    <a class="share-overlay-btn email-share-btn"><i class="share-icon icon-email"></i></a>\n    <div class="link-share-overlay">\n        <div class="input-append">\n            <input class="span3" type="text" value="<< sharedUrl >>">\n            <button class="btn" type="button" id="copy-button" data-clipboard-text="<< sharedUrl >>" title="Click to copy">Copy</button>\n        </div>\n    </div>\n</div>';window.Ibles.JST["post-comment"]='<div class="post-comment-container">\n    <form class="post-comment-form" name="PostCommentForm">\n        <input class="commentFiles" name="files" type="hidden" value=""/>\n        <div class="post-comment-box">\n            <div class="commenter-image pull-left">\n                <img class="postCommentAvatar" src="<< avatar >>" alt="<< author >>"/>\n            </div>\n            <div class="post-comment-body pull-right">\n                <div class="comment-tip" data-toggle="tooltip" data-placement="top" title="Highlight text to apply styling"></div>\n                <textarea class="postCommentBody redactorAirComment" name="content"></textarea>\n                <div class="comment-files hide"></div>\n            </div>\n            <div class="post-comment-toolbar clearfix">\n                <div class="policy pull-left">\n                    <img src="<< Ibles.staticUrl(\'img/instructable/comments/be-nice-en.png\') >>"/>\n                    <p>We have a be nice comment policy.<br> Please be positive and constructive.</p>\n                </div>\n                <div class="actions pull-right">\n                    <button class="addCommentImages btn">Add Images</button><button class="post-comment-btn btn btn-orange" data-loading-text="<i class=\'icon-spin icon-large\'></i>">Reply</button>\n                </div>\n            </div>\n            <ul class="instructable-image-bucket clearfix ui-sortable ui-droppable"></ul>\n        </div>\n    </form>\n</div>';window.Ibles.JST["post-comment-top-level"]='<form class="post-comment-form" name="PostCommentForm">\n    <input class="commentFiles" name="files" type="hidden" value=""/>\n    <div class="post-comment-box clearfix">\n        <div class="commenter-image pull-left">\n            <img class="postCommentAvatar" src="<< avatar >>" alt="Post a comment"/>\n        </div>\n        <div class="post-comment-body pull-right">\n            <div class="comment-tip" data-toggle="tooltip" data-placement="top" title="Highlight text to apply styling"></div>\n            <textarea class="postCommentBody redactorAirComment" name="content"></textarea>\n            <div class="alert alert-info imadeit-image-warning hide">\n                <button type="button" class="close">&times;</button>\n                <strong>"I Made It"</strong> comments require images. Uncheck for normal comment.\n            </div>\n            <div class="comment-error hide">\n            </div>\n        </div>\n        <div class="post-comment-toolbar clearfix">\n            <div class="policy pull-left">\n                <img src="<< Ibles.staticUrl(\'img/instructable/comments/be-nice-en.png\') >>" alt="Be nice!"/>\n                <p>We have a be nice comment policy.<br> Please be positive and constructive.</p>\n            </div>\n            <div class="comment-actions pull-right">\n                <button class="comment-imadeit-toggle btn"><i class="icon icon-checkmark1 hide"></i><i class="icon icon-imadeit"></i>&nbsp;   I Made it!</button>\n                <button class="addCommentImages btn"><i class="icon icon-camera selected">&nbsp;  </i>  Add Images</button>\n                <button class="btn post-comment-btn btn-orange" data-loading-text="<i class=\'icon-spin icon-large\'></i>">Post Comment</button>\n            </div>\n        </div>\n        <ul class="instructable-image-bucket clearfix ui-sortable ui-droppable"></ul>\n    </div>\n</form>';window.Ibles.JST["comment-list-item"]='<div class="comment" id="comment-<<id>>">\n    <div class="achievement-holder"></div>\n    <div class="avatar-container">\n        <a class="memberstats authorsMemberPageLink"><img src="<< avatar >>"></a>\n    </div>\n    <div class="comment-main-container">\n        <div class="comment-header">\n            <span class="comment-author">\n                <a class="author-link pro" href="/member/<<author>>"><<author>></a>\n                <span class="made-it-header comment-info hide"> made it!</span>\n                <span class="is-author comment-info hide">(author)</span>\n                <span class="is-reply hide">\n                    <i class="icon-caret-right comment-info"></i>\n                    <a class="reply-to" href="/member/<<replyAuthor>>"><<replyAuthor>></a>\n                </span>\n            </span>\n            <a class="action btn btn-mini pull-right replyToCommentBtn login-required">Reply</a>\n            <span class="comment-date pull-right comment-info"><<commentTime>></span>\n        </div>\n        <div class="quarantine-message"></div>\n        <div class="comment-body-container">\n            <div class="comment-body"><<body>></div>\n            <div  data-item-id="<< id >>" class="comment-photos"></div>\n        </div>\n        <div class="comment-files"></div>\n        <div class="comment-actions clearfix">\n            <span class="imadeit-checkbox pull-right hide action">\n                <input type="checkbox" class="imadeit-check" name=""/>IMadeIt\n            </span>\n            <span class="approved-checkbox pull-right hide action">\n                <input type="checkbox" class="approved-check" name=""/>Approved\n            </span>\n            <a class="action pull-right deleteThread hide">[delete thread]</a>\n            <a class="action pull-right deleteComment hide">[delete]</a>\n            <a class="action pull-right unquarantine-btn hide">[q-]</a>\n            <a class="action pull-right limboBtn hide">[+l]</a>\n            <span class="sticky-comment-checkbox pull-right hide action">\n                <input type="checkbox" class="sticky-check" name=""/>Feature Comment\n            </span>\n            <div class="action pull-right dropdown flagComment hide">\n                <a class="dropdown-toggle" data-toggle="dropdown" href="#">Flag</a>\n                <ul class="dropdown-menu">\n                    <li><a data-flagname="not_nice">Not Nice</a></li>\n                    <li><a data-flagname="inappropriate">Inappropriate</a></li>\n                    <li><a data-flagname="spam">Spam</a></li>\n                </ul>\n            </div>\n            <img class="request-img pull-right hide" src="/static/img/spinner.gif" height=\'10\' width=\'10\'/>\n            <img class="request-success pull-right hide" src="/static/img/ico_check.gif" height=\'10\' width=\'10\'/>\n            <img class="request-failure pull-right hide" src="/static/img/ico_cross.gif" height=\'10\' width=\'10\'/>\n        </div>\n    </div>\n</div>';window.Ibles.JST["comment-image-file"]='<a class="comment-photos-link" rel="fancybox-thumb-<< commentId >>" href="<< largeUrl >>" data-fancybox-href="/file/ << id >>">\n    <img class="photo fancybox-thumb" alt="Picture of << name >>" data-image-id="<< id >>" data-notes=\'<< imageNotes >>\' data-orig-height="<< height >>" data-orig-width="<< width >>" src="<< mediumUrl >>"/>\n</a>';window.Ibles.JST["comment-attached-file"]='<a href="<< originalUrl >>">\n    <img src="<< tinyUrl >>" alt=""/>\n    <span class="entryExtraTitle"><< name >></span>\n</a>';window.Ibles.JST["imadeit-modal"]='<button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>\n<div class="modal-body">\n    <img src="/static/img/robot.png" width="100"/>\n    <div>\n        <p>We noticed you attached photos<br/>to your comment.</p>\n        <h2>Did you make this instructable?</h2>\n    </div>\n    <div class="two-buttons">\n        <button class="btn btn-large imadeit-no" data-dismiss="modal">\n            <i class="bg-icon instructable"></i>\n            No, just adding photos.\n        </button>\n        <button class="btn btn-large btn-primary btn-orange imadeit-yes">\n            <i class="bg-icon imadeit white"></i>\n            Yes, I made it!\n        </button>\n    </div>\n</div>';window.Ibles.JST["statscard"]='<div class="statscard">\n    <[ if (data.instructablesCount) { ]>\n    <div class="header clearfix">\n        <div class="col main-stat"><span class="count instructables-count"><< data.instructablesCount >></span><br/> Instructables</div>\n        <[ if (data.publishedCollectionsCount) { ]>\n        <div class="col main-stat"><span class="count collections-count"><< data.publishedCollectionsCount >></span><br/> Collections</div>\n        <[ } ]>\n        <div class="col other-stats">\n            <div class="views"><i class="icon-views1"></i> <span class="count"><< data.views >></span> Views</div>\n            <div class="favorites"><i class="icon-favorite"></i> <span class="count"><< data.favoritesCount >></span> Favorited</div>\n        </div>\n    </div>\n    <[ } ]>\n    <div class="body">\n        <div class="author-box clearfix">\n            <div class="author-image">\n                <a href="/member/<< encodeURIComponent(data.screenName) >>/">\n                    <img src="<< data.square2Url >>"/>\n                </a>\n            </div>\n            <div class="author-details">\n                <div class="screen-name">\n                    <a href="/member/<< encodeURIComponent(data.screenName) >>/"><< data.screenName >></a>\n                </div>\n                <div class="signup-info">\n                    Joined << data.signup >> <[ if (data.pro) { ]><img src="/static/img/statscard/pro.gif"/><[ } ]>\n                </div>\n                <div class="follow">\n                    <a class="btn btn-yellow follow-btn" data-followtxt="Follow" data-followingtxt="Following" data-unfollowtxt="Unfollow">\n                        <[ if (data.following) { ]>\n                            <i class="bg-icon checkmarksmall active"></i>&nbsp; <span>Following</span>\n                        <[ } else { ]>\n                            <i class="bg-icon plus active"></i>&nbsp; <span>Follow</span>\n                        <[ } ]>\n                    </a>\n                    <span class="callout"><< data.followersCount >></span>\n                </div>\n                <div class="private-message">\n                    <a class="btn" href="/edit/compose?recipientId=<< data.id >>&amp;linkTo=/member/<< encodeURIComponent(data.screenName) >>/"><i class="bg-icon email"></i>Message</a>\n                </div>\n            </div>\n        </div>\n        <[ if (data.about && data.about.length > 0) { ]>\n            <div class="bio">\n                <a href="/member/<< encodeURIComponent(data.screenName) >>/"><span class="ibl">Bio:</span> << data.about >></a>\n            </div>\n        <[ } ]>\n    </div>\n</div>';window.Ibles.JST["statscard-wrapper"]='<div class="popover statscard-popover"><div class="arrow"></div><div class="popover-content"></div></div>';window.Ibles.JST["achievement"]='<i style="display:none" class="achievement achievement-featured icon-featured"></i>\n<i style="display:none" class="achievement achievement-comments icon-comments"></i>\n<i style="display:none" class="achievement achievement-views icon-views1"></i>\n<div style="display:none" class="achievement-popover-wrapper">\n    <div style="display:none" class="coin-wrapper coin-featured-wrapper">\n        <p></p>\n        <i class="achievement-coin achievement-coin-featured"></i>\n    </div>\n    <div style="display:none" class="coin-wrapper coin-comments-wrapper">\n        <p></p>\n        <i class="achievement-coin achievement-coin-comments"></i>\n    </div>\n    <div style="display:none" class="coin-wrapper coin-views-wrapper">\n        <p></p>\n        <i class="achievement-coin achievement-coin-views"></i>\n    </div>\n</div>';window.Ibles.JST["add-to-contest-modal"]='<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n    <h3>Contests</h3>\n</div>\n<div class="modal-body">\n    <div class="loading center">\n        <h4>Loading...</h4>\n        <img src="<< Ibles.staticUrl(\'img/lb_loading.gif\') >>"/>\n    </div>\n    <ul class="unstyled eligible-contests hide"></ul>\n    <p class="msg hide no-contests-msg">Sorry, there are no contests that this instructable can join. Only Instructables published after a contest start date are eligible to join. <br><br>Create a <a href="<< Ibles.reverseUrls.editorCreate() >>">new instructable.</a></p>\n</div>\n<div class="modal-footer">\n    <a class="btn" data-dismiss="modal">Close</a>\n</div>';window.Ibles.JST["add-to-contest-modal-list-item"]='<div class="addable-item addable-contest clearfix">\n    <div class="image">\n        <a href="<< url >>"><img src="<< squareUrl >>"/></a>\n    </div>\n    <div class="title">\n        <h4><a href="<< url >>"><< title >> <[ if (onlyUS) { ]>(US Only)<[ }]></a></h4>\n        <[ if (onlyUS) { ]>\n            <label class="checkbox">\n                <input class="us-only-checkbox" type="checkbox" data-contestid="<< id >>"> I\'m a US resident.\n            </label>\n        <[ } ]>\n        <a class="btn add-btn <[ if (!entered && onlyUS) { ]>disabled<[ } ]>"\n            data-added-text="<i class=\'bg-icon checkmark active\'></i>&nbsp; Added"\n            data-add-text="<i class=\'bg-icon checkmark\'></i>&nbsp; Add"\n            data-pending-text="<i class=\'bg-icon checkmark active\'></i>&nbsp; Pending Approval"\n            data-remove-text="<i class=\'bg-icon checkmark active\'></i>&nbsp; Remove"\n            data-loading-text="<i class=\'bg-icon checkmark\'></i>&nbsp; Loading...">\n            <[ if (pending) { ]>\n                <i class="bg-icon checkmark active"></i>&nbsp; Pending Approval\n            <[ } else if (!entered) { ]>\n                <i class="bg-icon checkmark"></i>&nbsp; Add\n            <[ } else { ]>\n                <i class="bg-icon checkmark active"></i>&nbsp; Added\n            <[ } ]>\n        </a>\n    </div>\n</div>';window.Ibles.JST["add-to-group-modal"]='<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n    <h3>Groups</h3>\n</div>\n<div class="modal-body">\n    <div class="loading center">\n        <h4>Loading...</h4>\n        <img src="<< Ibles.staticUrl(\'img/lb_loading.gif\') >>"/>\n    </div>\n    <ul class="unstyled eligible-groups hide"></ul>\n    <p class="msg hide no-groups-msg">Sorry, you are not a member of any group.</p>\n</div>\n<div class="modal-footer">\n    <a class="btn" data-dismiss="modal">Close</a>\n</div>';window.Ibles.JST["add-to-group-modal-list-item"]='<div class="addable-item addable-group clearfix">\n    <div class="image"><a href="<< url >>"><img src="<< smallUrl >>"/></a></div>\n    <div class="title">\n        <h4><a href="<< url >>"><< title >></a></h4>\n        <[ if (!added && groupCategories.length) { ]>\n            <select class="group-categories-dropdown">\n                <option value="">Category...</option>\n                <[ _.each(groupCategories, function(groupCategory) { ]>\n                    <option value="<< groupCategory >>"><< groupCategory >></option>\n                <[ }); ]>\n            </select>\n        <[ } ]>\n        <a class="btn add-btn"\n            data-added-text="<i class=\'bg-icon checkmark active\'></i>&nbsp; Added"\n            data-add-text="<i class=\'bg-icon checkmark\'></i>&nbsp; Add"\n            data-remove-text="<i class=\'bg-icon checkmark active\'></i>&nbsp; Remove"\n            data-loading-text="<i class=\'bg-icon checkmark\'></i>&nbsp; Loading...">\n            <[ if (added) { ]>\n                <i class="bg-icon checkmark active"></i>&nbsp; <span>Added</span>\n            <[ } else { ]>\n                <i class="bg-icon checkmark"></i>&nbsp;<span>Add</span>\n            <[ } ]>              \n        </a>\n    </div>\n</div>';(function(){function e(){}function t(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var i=e.prototype;i.getListeners=function(e){var t,n,i=this._getEvents();if("object"==typeof e){t={};for(n in i)i.hasOwnProperty(n)&&e.test(n)&&(t[n]=i[n])}else t=i[e]||(i[e]=[]);return t},i.flattenListeners=function(e){var t,n=[];for(t=0;e.length>t;t+=1)n.push(e[t].listener);return n},i.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},i.addListener=function(e,n){var i,r=this.getListenersAsObject(e),o="object"==typeof n;for(i in r)r.hasOwnProperty(i)&&-1===t(r[i],n)&&r[i].push(o?n:{listener:n,once:!1});return this},i.on=n("addListener"),i.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},i.once=n("addOnceListener"),i.defineEvent=function(e){return this.getListeners(e),this},i.defineEvents=function(e){for(var t=0;e.length>t;t+=1)this.defineEvent(e[t]);return this},i.removeListener=function(e,n){var i,r,o=this.getListenersAsObject(e);for(r in o)o.hasOwnProperty(r)&&(i=t(o[r],n),-1!==i&&o[r].splice(i,1));return this},i.off=n("removeListener"),i.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},i.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},i.manipulateListeners=function(e,t,n){var i,r,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(i=n.length;i--;)o.call(this,t,n[i]);else for(i in t)t.hasOwnProperty(i)&&(r=t[i])&&("function"==typeof r?o.call(this,i,r):s.call(this,i,r));return this},i.removeEvent=function(e){var t,n=typeof e,i=this._getEvents();if("string"===n)delete i[e];else if("object"===n)for(t in i)i.hasOwnProperty(t)&&e.test(t)&&delete i[t];else delete this._events;return this},i.removeAllListeners=n("removeEvent"),i.emitEvent=function(e,t){var n,i,r,o,s=this.getListenersAsObject(e);for(r in s)if(s.hasOwnProperty(r))for(i=s[r].length;i--;)n=s[r][i],n.once===!0&&this.removeListener(e,n.listener),o=n.listener.apply(this,t||[]),o===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},i.trigger=n("emitEvent"),i.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},i.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},i._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},i._getEvents=function(){return this._events||(this._events={})},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return e}):"object"==typeof module&&module.exports?module.exports=e:this.EventEmitter=e}).call(this),function(e){var t=document.documentElement,n=function(){};t.addEventListener?n=function(e,t,n){e.addEventListener(t,n,!1)}:t.attachEvent&&(n=function(t,n,i){t[n+i]=i.handleEvent?function(){var t=e.event;t.target=t.target||t.srcElement,i.handleEvent.call(i,t)}:function(){var n=e.event;n.target=n.target||n.srcElement,i.call(t,n)},t.attachEvent("on"+n,t[n+i])});var i=function(){};t.removeEventListener?i=function(e,t,n){e.removeEventListener(t,n,!1)}:t.detachEvent&&(i=function(e,t,n){e.detachEvent("on"+t,e[t+n]);try{delete e[t+n]}catch(i){e[t+n]=void 0}});var r={bind:n,unbind:i};"function"==typeof define&&define.amd?define("eventie/eventie",r):e.eventie=r}(this),function(e){function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e){return"[object Array]"===c.call(e)}function i(e){var t=[];if(n(e))t=e;else if("number"==typeof e.length)for(var i=0,r=e.length;r>i;i++)t.push(e[i]);else t.push(e);return t}function r(e,n){function r(e,n,s){if(!(this instanceof r))return new r(e,n);"string"==typeof e&&(e=document.querySelectorAll(e)),this.elements=i(e),this.options=t({},this.options),"function"==typeof n?s=n:t(this.options,n),s&&this.on("always",s),this.getImages(),o&&(this.jqDeferred=new o.Deferred);var a=this;setTimeout(function(){a.check()})}function c(e){this.img=e}r.prototype=new e,r.prototype.options={},r.prototype.getImages=function(){this.images=[];for(var e=0,t=this.elements.length;t>e;e++){var n=this.elements[e];"IMG"===n.nodeName&&this.addImage(n);for(var i=n.querySelectorAll("img"),r=0,o=i.length;o>r;r++){var s=i[r];this.addImage(s)}}},r.prototype.addImage=function(e){var t=new c(e);this.images.push(t)},r.prototype.check=function(){function e(e,r){return t.options.debug&&a&&s.log("confirm",e,r),t.progress(e),n++,n===i&&t.complete(),!0}var t=this,n=0,i=this.images.length;if(this.hasAnyBroken=!1,!i)return this.complete(),void 0;for(var r=0;i>r;r++){var o=this.images[r];o.on("confirm",e),o.check()}},r.prototype.progress=function(e){this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded;var t=this;setTimeout(function(){t.emit("progress",t,e),t.jqDeferred&&t.jqDeferred.notify(t,e)})},r.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var t=this;setTimeout(function(){if(t.emit(e,t),t.emit("always",t),t.jqDeferred){var n=t.hasAnyBroken?"reject":"resolve";t.jqDeferred[n](t)}})},o&&(o.fn.imagesLoaded=function(e,t){var n=new r(this,e,t);return n.jqDeferred.promise(o(this))});var f={};return c.prototype=new e,c.prototype.check=function(){var e=f[this.img.src];if(e)return this.useCached(e),void 0;if(f[this.img.src]=this,this.img.complete&&void 0!==this.img.naturalWidth)return this.confirm(0!==this.img.naturalWidth,"naturalWidth"),void 0;var t=this.proxyImage=new Image;n.bind(t,"load",this),n.bind(t,"error",this),t.src=this.img.src},c.prototype.useCached=function(e){if(e.isConfirmed)this.confirm(e.isLoaded,"cached was confirmed");else{var t=this;e.on("confirm",function(e){return t.confirm(e.isLoaded,"cache emitted confirmed"),!0})}},c.prototype.confirm=function(e,t){this.isConfirmed=!0,this.isLoaded=e,this.emit("confirm",this,t)},c.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},c.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindProxyEvents()},c.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindProxyEvents()},c.prototype.unbindProxyEvents=function(){n.unbind(this.proxyImage,"load",this),n.unbind(this.proxyImage,"error",this)},r}var o=e.jQuery,s=e.console,a=s!==void 0,c=Object.prototype.toString;"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],r):e.imagesLoaded=r(e.EventEmitter,e.eventie)}(window);(function($,window,document,undefined){"use strict";var $event=$.event,$special,dummy={_:0},frame=0,wasResized,animRunning;$special=$event.special.throttledresize={setup:function(){$(this).on("resize",$special.handler)},teardown:function(){$(this).off("resize",$special.handler)},handler:function(event,execAsap){var context=this,args=arguments;wasResized=true;if(!animRunning){setInterval(function(){frame++;if(frame>$special.threshold&&wasResized||execAsap){event.type="throttledresize";$event.dispatch.apply(context,args);wasResized=false;frame=0}if(frame>9){$(dummy).stop();animRunning=false;frame=0}},30);animRunning=true}},threshold:0}})(jQuery,window,document);(function(t,m,e){var l=e(t),q=e(m),a=e.fancybox=function(){a.open.apply(this,arguments)},r=!1,s="undefined"!==typeof m.createTouch;e.extend(a,{version:"2.0.5",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,autoSize:!0,autoResize:!s,autoCenter:!s,fitToView:!0,aspectRatio:!1,topRatio:.5,fixed:!(e.browser.msie&&6>=e.browser.version)&&!s,scrolling:"auto",wrapCSS:"fancybox-default",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},keys:{next:[13,32,34,39,40],prev:[8,33,37,38],close:[27]},tpl:{wrap:'<div class="fancybox-wrap"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe class="fancybox-iframe" name="fancybox-frame{rnd}" frameborder="0" hspace="0"'+(e.browser.msie?' allowtransparency="true"':"")+"></iframe>",swf:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="wmode" value="transparent" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{href}" /><embed src="{href}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="100%" height="100%" wmode="transparent"></embed></object>',error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<div title="Close" class="fancybox-item fancybox-close"></div>',next:'<a title="Next" class="fancybox-nav fancybox-next"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:300,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:300,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:{speedIn:0,speedOut:300,opacity:.8,css:{cursor:"pointer"},closeClick:!0},title:{type:"float"}}},group:{},opts:{},coming:null,current:null,isOpen:!1,isOpened:!1,wrap:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(b,c){a.close(!0);b&&!e.isArray(b)&&(b=b instanceof e?e(b).get():[b]);a.isActive=!0;a.opts=e.extend(!0,{},a.defaults,c);e.isPlainObject(c)&&"undefined"!==typeof c.keys&&(a.opts.keys=c.keys?e.extend({},a.defaults.keys,c.keys):!1);a.group=b;a._start(a.opts.index||0)},cancel:function(){a.coming&&!1===a.trigger("onCancel")||(a.coming=null,a.hideLoading(),a.ajaxLoad&&a.ajaxLoad.abort(),a.ajaxLoad=null,a.imgPreload&&(a.imgPreload.onload=a.imgPreload.onabort=a.imgPreload.onerror=null))},close:function(b){a.cancel();a.current&&!1!==a.trigger("beforeClose")&&(a.unbindEvents(),!a.isOpen||b&&!0===b[0]?(e(".fancybox-wrap").stop().trigger("onReset").remove(),a._afterZoomOut()):(a.isOpen=a.isOpened=!1,e(".fancybox-item, .fancybox-nav").remove(),a.wrap.stop(!0).removeClass("fancybox-opened"),a.inner.css("overflow","hidden"),a.transitions[a.current.closeMethod]()))},play:function(b){var c=function(){clearTimeout(a.player.timer)},d=function(){c();a.current&&a.player.isActive&&(a.player.timer=setTimeout(a.next,a.current.playSpeed))},g=function(){c();e("body").unbind(".player");a.player.isActive=!1;a.trigger("onPlayEnd")};if(a.player.isActive||b&&!1===b[0])g();else if(a.current&&(a.current.loop||a.current.index<a.group.length-1))a.player.isActive=!0,e("body").bind({"afterShow.player onUpdate.player":d,"onCancel.player beforeClose.player":g,"beforeLoad.player":c}),d(),a.trigger("onPlayStart")},next:function(){a.current&&a.jumpto(a.current.index+1)},prev:function(){a.current&&a.jumpto(a.current.index-1)},jumpto:function(b){a.current&&(b=parseInt(b,10),1<a.group.length&&a.current.loop&&(b>=a.group.length?b=0:0>b&&(b=a.group.length-1)),"undefined"!==typeof a.group[b]&&(a.cancel(),a._start(b)))},reposition:function(b){a.isOpen&&a.wrap.css(a._getPosition(b))},update:function(b){a.isOpen&&(r||setTimeout(function(){var c=a.current;if(r&&(r=!1,c)){if(c.autoResize||b&&"orientationchange"===b.type)c.autoSize&&(a.inner.height("auto"),c.height=a.inner.height()),a._setDimension(),c.canGrow&&a.inner.height("auto");c.autoCenter&&a.reposition();a.trigger("onUpdate")}},100),r=!0)},toggle:function(){a.isOpen&&(a.current.fitToView=!a.current.fitToView,a.update())},hideLoading:function(){e("#fancybox-loading").remove()},showLoading:function(){a.hideLoading();e('<div id="fancybox-loading"><div></div></div>').click(a.cancel).appendTo("body")},getViewport:function(){return{x:l.scrollLeft(),y:l.scrollTop(),w:l.width(),h:l.height()}},unbindEvents:function(){a.wrap&&a.wrap.unbind(".fb");q.unbind(".fb");l.unbind(".fb")},bindEvents:function(){var b=a.current,c=b.keys;b&&(l.bind("resize.fb, orientationchange.fb",a.update),c&&q.bind("keydown.fb",function(b){var g;!b.ctrlKey&&!b.altKey&&!b.shiftKey&&!b.metaKey&&0>e.inArray(b.target.tagName.toLowerCase(),["input","textarea","select","button"])&&(g=b.keyCode,-1<e.inArray(g,c.close)?(a.close(),b.preventDefault()):-1<e.inArray(g,c.next)?(a.next(),b.preventDefault()):-1<e.inArray(g,c.prev)&&(a.prev(),b.preventDefault()))}),e.fn.mousewheel&&b.mouseWheel&&1<a.group.length&&a.wrap.bind("mousewheel.fb",function(b,c){var f=e(b.target).get(0);if(0===f.clientHeight||f.scrollHeight===f.clientHeight&&f.scrollWidth===f.clientWidth)b.preventDefault(),a[0<c?"prev":"next"]()}))},trigger:function(b){var c,d=a[-1<e.inArray(b,["onCancel","beforeLoad","afterLoad"])?"coming":"current"];if(d){e.isFunction(d[b])&&(c=d[b].apply(d,Array.prototype.slice.call(arguments,1)));
if(!1===c)return!1;d.helpers&&e.each(d.helpers,function(c,f){if(f&&"undefined"!==typeof a.helpers[c]&&e.isFunction(a.helpers[c][b]))a.helpers[c][b](f,d)});e.event.trigger(b+".fb")}},isImage:function(a){return a&&a.match(/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i)},isSWF:function(a){return a&&a.match(/\.(swf)(.*)?$/i)},_start:function(b){var c={},d=a.group[b]||null,g,f,k;if(d&&(d.nodeType||d instanceof e))g=!0,e.metadata&&(c=e(d).metadata());c=e.extend(!0,{},a.opts,{index:b,element:d},e.isPlainObject(d)?d:c);e.each(["href","title","content","type"],function(b,f){c[f]=a.opts[f]||g&&e(d).attr(f)||c[f]||null});"number"===typeof c.margin&&(c.margin=[c.margin,c.margin,c.margin,c.margin]);c.modal&&e.extend(!0,c,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{css:{cursor:"auto"},closeClick:!1}}});a.coming=c;if(!1===a.trigger("beforeLoad"))a.coming=null;else{f=c.type;b=c.href||d;f||(g&&(k=e(d).data("fancybox-type"),!k&&d.className&&(f=(k=d.className.match(/fancybox\.(\w+)/))?k[1]:null)),!f&&"string"===e.type(b)&&(a.isImage(b)?f="image":a.isSWF(b)?f="swf":b.match(/^#/)&&(f="inline")),f||(f=g?"inline":"html"),c.type=f);if("inline"===f||"html"===f){if(c.content||(c.content="inline"===f?e("string"===e.type(b)?b.replace(/.*(?=#[^\s]+$)/,""):b):d),!c.content||!c.content.length)f=null}else b||(f=null);c.group=a.group;c.isDom=g;c.href=b;"image"===f?a._loadImage():"ajax"===f?a._loadAjax():f?a._afterLoad():a._error("type")}},_error:function(b){a.hideLoading();e.extend(a.coming,{type:"html",autoSize:!0,minHeight:0,hasError:b,content:a.coming.tpl.error});a._afterLoad()},_loadImage:function(){a.imgPreload=new Image;a.imgPreload.onload=function(){this.onload=this.onerror=null;a.coming.width=this.width;a.coming.height=this.height;a._afterLoad()};a.imgPreload.onerror=function(){this.onload=this.onerror=null;a._error("image")};a.imgPreload.src=a.coming.href;a.imgPreload.width||a.showLoading()},_loadAjax:function(){a.showLoading();a.ajaxLoad=e.ajax(e.extend({},a.coming.ajax,{url:a.coming.href,error:function(b,c){"abort"!==c?a._error("ajax",b):a.hideLoading()},success:function(b,c){"success"===c&&(a.coming.content=b,a._afterLoad())}}))},_preloadImages:function(){var b=a.group,c=a.current,d=b.length,g;if(c.preload&&!(2>b.length))for(var f=1;f<=Math.min(c.preload,d-1);f++)if(g=b[(c.index+f)%d],g=e(g).attr("href")||g)(new Image).src=g},_afterLoad:function(){a.hideLoading();!a.coming||!1===a.trigger("afterLoad",a.current)?a.coming=!1:(a.isOpened?(e(".fancybox-item").remove(),a.wrap.stop(!0).removeClass("fancybox-opened"),a.inner.css("overflow","hidden"),a.transitions[a.current.prevMethod]()):(e(".fancybox-wrap").stop().trigger("onReset").remove(),a.trigger("afterClose")),a.unbindEvents(),a.isOpen=!1,a.current=a.coming,a.wrap=e(a.current.tpl.wrap).addClass("fancybox-"+(s?"mobile":"desktop")+" fancybox-tmp "+a.current.wrapCSS).appendTo("body"),a.outer=e(".fancybox-outer",a.wrap).css("padding",a.current.padding+"px"),a.inner=e(".fancybox-inner",a.wrap),a._setContent())},_setContent:function(){var b,c,d=a.current,g=d.type;switch(g){case"inline":case"ajax":case"html":b=d.content;b instanceof e&&(b=b.show().detach(),b.parent().hasClass("fancybox-inner")&&b.parents(".fancybox-wrap").trigger("onReset").remove(),e(a.wrap).bind("onReset",function(){b.appendTo("body").hide()}));d.autoSize&&(c=e('<div class="fancybox-tmp '+a.current.wrapCSS+'"></div>').appendTo("body").append(b),d.width=c.width(),d.height=c.height(),c.width(a.current.width),c.height()>d.height&&(c.width(d.width+1),d.width=c.width(),d.height=c.height()),b=c.contents().detach(),c.remove());break;case"image":b=d.tpl.image.replace("{href}",d.href);d.aspectRatio=!0;break;case"swf":b=d.tpl.swf.replace(/\{width\}/g,d.width).replace(/\{height\}/g,d.height).replace(/\{href\}/g,d.href)}if("iframe"===g){b=e(d.tpl.iframe.replace("{rnd}",(new Date).getTime())).attr("scrolling",d.scrolling);d.scrolling="auto";if(d.autoSize){b.width(d.width);a.showLoading();b.data("ready",!1).appendTo(a.inner).bind({onCancel:function(){e(this).unbind();a._afterZoomOut()},load:function(){var b=e(this),c;try{this.contentWindow.document.location&&(c=b.contents().find("body").height()+12,b.height(c))}catch(g){d.autoSize=!1}!1===b.data("ready")?(a.hideLoading(),c&&(a.current.height=c),a._beforeShow(),b.data("ready",!0)):c&&a.update()}}).attr("src",d.href);return}b.attr("src",d.href)}else if("image"===g||"swf"===g)d.autoSize=!1,d.scrolling="visible";a.inner.append(b);a._beforeShow()},_beforeShow:function(){a.coming=null;a.trigger("beforeShow");a._setDimension();a.wrap.hide().removeClass("fancybox-tmp");a.bindEvents();a._preloadImages();a.transitions[a.isOpened?a.current.nextMethod:a.current.openMethod]()},_setDimension:function(){var b=a.wrap,c=a.outer,d=a.inner,g=a.current,f=a.getViewport(),k=g.margin,h=2*g.padding,i=g.width,j=g.height,o=g.maxWidth,l=g.maxHeight,p=g.minWidth,m=g.minHeight,n;f.w-=k[1]+k[3];f.h-=k[0]+k[2];-1<i.toString().indexOf("%")&&(i=(f.w-h)*parseFloat(i)/100);-1<j.toString().indexOf("%")&&(j=(f.h-h)*parseFloat(j)/100);k=i/j;i+=h;j+=h;g.fitToView&&(o=Math.min(f.w,o),l=Math.min(f.h,l));g.aspectRatio?(i>o&&(i=o,j=(i-h)/k+h),j>l&&(j=l,i=(j-h)*k+h),i<p&&(i=p,j=(i-h)/k+h),j<m&&(j=m,i=(j-h)*k+h)):(i=Math.max(p,Math.min(i,o)),j=Math.max(m,Math.min(j,l)));i=Math.round(i);j=Math.round(j);e(b.add(c).add(d)).width("auto").height("auto");d.width(i-h).height(j-h);b.width(i);n=b.height();if(i>o||n>l)for(;(i>o||n>l)&&i>p&&n>m;)j-=10,g.aspectRatio?(i=Math.round((j-h)*k+h),i<p&&(i=p,j=(i-h)/k+h)):i-=10,d.width(i-h).height(j-h),b.width(i),n=b.height();g.dim={width:i,height:n};g.canGrow=g.autoSize&&j>m&&j<l;g.canShrink=!1;g.canExpand=!1;if(i-h<g.width||j-h<g.height)g.canExpand=!0;else if((i>f.w||n>f.h)&&i>p&&j>m)g.canShrink=!0;b=n-h;a.innerSpace=b-d.height();a.outerSpace=b-c.height()},_getPosition:function(b){var c=a.current,d=a.getViewport(),e=c.margin,f=a.wrap.width()+e[1]+e[3],k=a.wrap.height()+e[0]+e[2],h={position:"absolute",top:e[0]+d.y,left:e[3]+d.x};if(c.fixed&&(!b||!1===b[0])&&k<=d.h&&f<=d.w)h={position:"fixed",top:e[0],left:e[3]};h.top=Math.ceil(Math.max(h.top,h.top+(d.h-k)*c.topRatio))+"px";h.left=Math.ceil(Math.max(h.left,h.left+.5*(d.w-f)))+"px";return h},_afterZoomIn:function(){var b=a.current,c=b.scrolling;a.isOpen=a.isOpened=!0;a.wrap.addClass("fancybox-opened").css("overflow","visible");a.update();a.inner.css("overflow","yes"===c?"scroll":"no"===c?"hidden":c);if(b.closeClick||b.nextClick)a.inner.css("cursor","pointer").bind("click.fb",b.nextClick?a.next:a.close);b.closeBtn&&e(b.tpl.closeBtn).appendTo(a.outer).bind("click.fb",a.close);b.arrows&&1<a.group.length&&((b.loop||0<b.index)&&e(b.tpl.prev).appendTo(a.inner).bind("click.fb",a.prev),(b.loop||b.index<a.group.length-1)&&e(b.tpl.next).appendTo(a.inner).bind("click.fb",a.next));a.trigger("afterShow");a.opts.autoPlay&&!a.player.isActive&&(a.opts.autoPlay=!1,a.play())},_afterZoomOut:function(){a.trigger("afterClose");a.wrap.trigger("onReset").remove();e.extend(a,{group:{},opts:{},current:null,isActive:!1,isOpened:!1,isOpen:!1,wrap:null,outer:null,inner:null})}});a.transitions={getOrigPosition:function(){var b=a.current,c=b.element,d=b.padding,g=e(b.orig),f={},k=50,h=50;!g.length&&b.isDom&&e(c).is(":visible")&&(g=e(c).find("img:first"),g.length||(g=e(c)));g.length?(f=g.offset(),g.is("img")&&(k=g.outerWidth(),h=g.outerHeight())):(b=a.getViewport(),f.top=b.y+.5*(b.h-h),f.left=b.x+.5*(b.w-k));return f={top:Math.ceil(f.top-d)+"px",left:Math.ceil(f.left-d)+"px",width:Math.ceil(k+2*d)+"px",height:Math.ceil(h+2*d)+"px"}},step:function(b,c){var d,e,f;if("width"===c.prop||"height"===c.prop)e=f=Math.ceil(b-2*a.current.padding),"height"===c.prop&&(d=(b-c.start)/(c.end-c.start),c.start>c.end&&(d=1-d),e-=a.innerSpace*d,f-=a.outerSpace*d),a.inner[c.prop](e),a.outer[c.prop](f)},zoomIn:function(){var b=a.wrap,c=a.current,d,g;d=c.dim;"elastic"===c.openEffect?(g=e.extend({},d,a._getPosition(!0)),delete g.position,d=this.getOrigPosition(),c.openOpacity&&(d.opacity=0,g.opacity=1),a.outer.add(a.inner).width("auto").height("auto"),b.css(d).show(),b.animate(g,{duration:c.openSpeed,easing:c.openEasing,step:this.step,complete:a._afterZoomIn})):(b.css(e.extend({},d,a._getPosition())),"fade"===c.openEffect?b.fadeIn(c.openSpeed,a._afterZoomIn):(b.show(),a._afterZoomIn()))},zoomOut:function(){var b=a.wrap,c=a.current,d;"elastic"===c.closeEffect?("fixed"===b.css("position")&&b.css(a._getPosition(!0)),d=this.getOrigPosition(),c.closeOpacity&&(d.opacity=0),b.animate(d,{duration:c.closeSpeed,easing:c.closeEasing,step:this.step,complete:a._afterZoomOut})):b.fadeOut("fade"===c.closeEffect?c.closeSpeed:0,a._afterZoomOut)},changeIn:function(){var b=a.wrap,c=a.current,d;"elastic"===c.nextEffect?(d=a._getPosition(!0),d.opacity=0,d.top=parseInt(d.top,10)-200+"px",b.css(d).show().animate({opacity:1,top:"+=200px"},{duration:c.nextSpeed,easing:c.nextEasing,complete:a._afterZoomIn})):(b.css(a._getPosition()),"fade"===c.nextEffect?b.hide().fadeIn(c.nextSpeed,a._afterZoomIn):(b.show(),a._afterZoomIn()))},changeOut:function(){var b=a.wrap,c=a.current,d=function(){e(this).trigger("onReset").remove()};b.removeClass("fancybox-opened");"elastic"===c.prevEffect?b.animate({opacity:0,top:"+=200px"},{duration:c.prevSpeed,easing:c.prevEasing,complete:d}):b.fadeOut("fade"===c.prevEffect?c.prevSpeed:0,d)}};a.helpers.overlay={overlay:null,update:function(){var a,c;this.overlay.width(0).height(0);e.browser.msie?(a=Math.max(m.documentElement.scrollWidth,m.body.scrollWidth),c=Math.max(m.documentElement.offsetWidth,m.body.offsetWidth),a=a<c?l.width():a):a=q.width();this.overlay.width(a).height(q.height())},beforeShow:function(b){this.overlay||(b=e.extend(!0,{speedIn:"fast",closeClick:!0,opacity:1,css:{background:"black"}},b),this.overlay=e('<div id="fancybox-overlay"></div>').css(b.css).appendTo("body"),this.update(),b.closeClick&&this.overlay.bind("click.fb",a.close),l.bind("resize.fb",e.proxy(this.update,this)),this.overlay.fadeTo(b.speedIn,b.opacity))},onUpdate:function(){this.update()},afterClose:function(a){this.overlay&&this.overlay.fadeOut(a.speedOut||0,function(){e(this).remove()});this.overlay=null}};a.helpers.title={beforeShow:function(b){var c;if(c=a.current.title)c=e('<div class="fancybox-title fancybox-title-'+b.type+'-wrap">'+c+"</div>").appendTo("body"),"float"===b.type&&(c.width(c.width()),c.wrapInner('<span class="child"></span>'),a.current.margin[2]+=Math.abs(parseInt(c.css("margin-bottom"),10))),c.appendTo("over"===b.type?a.inner:"outside"===b.type?a.wrap:a.outer)}};e.fn.fancybox=function(b){var c=e(this),d=this.selector||"",g,f=function(f){var h=this,i="rel",j=h[i],l=g;!f.ctrlKey&&!f.altKey&&!f.shiftKey&&!f.metaKey&&(f.preventDefault(),j||(i="data-fancybox-group",j=e(h).attr("data-fancybox-group")),j&&""!==j&&"nofollow"!==j&&(h=d.length?e(d):c,h=h.filter("["+i+'="'+j+'"]'),l=h.index(this)),b.index=l,a.open(h,b))},b=b||{};g=b.index||0;d?q.undelegate(d,"click.fb-start").delegate(d,"click.fb-start",f):c.unbind("click.fb-start").bind("click.fb-start",f);return this}})(window,document,jQuery);(function($,F){var W=$(window),D=$(document),isMobile=typeof document.createTouch!=="undefined";$.extend(F.defaults,{wrapCSS:"photoset-fancybox",scrolling:"visible",aspectRatio:true,loop:false,prevSpeed:600,nextSpeed:600,keys:{next:[13,32,39],prev:[37],close:[27]},helpers:{overlay:null,PhotosetOverlay:{}}});F.transitions.changeIn=function(){var wrap=F.wrap,current=F.current,startPos=F._getPosition(true);if(!F.isForward){startPos.left=parseInt(startPos.left,10)-1500+"px";wrap.css(startPos).show().animate({left:"+=1500px"},{duration:current.nextSpeed,complete:F._afterZoomIn})}else{startPos.left=parseInt(startPos.left,10)+1500+"px";wrap.css(startPos).show().animate({left:"-=1500px"},{duration:current.nextSpeed,complete:F._afterZoomIn})}};F.transitions.changeOut=function(){var wrap=F.wrap,current=F.current,cleanUp=function(){$(this).trigger("onReset").remove()},leftAmt;wrap.removeClass("fancybox-opened");if(F.isForward){leftAmt="-=1500px"}else{leftAmt="+=1500px"}if(current.prevEffect==="elastic"){wrap.animate({opacity:.4,left:leftAmt},{duration:current.prevSpeed,complete:cleanUp})}};F.next=function(){if(F.current){F.isForward=true;F.jumpto(F.current.index+1)}};F.prev=function(){if(F.current){F.isForward=false;F.jumpto(F.current.index-1)}};F.closeOrig=F.close;F.close=function(a){if(typeof a==="object"&&a.target){var target=$(a.target);if(target.attr("id")===F.overlayId||target.hasClass("fancybox-close")&&$(this).attr("id")!==F.overlayId||target.hasClass("transparency"))F.closeOrig(a);return}F.closeOrig(a)};F._afterZoomOut=function(){F.trigger("afterClose")};F.getViewport=function(){return{x:W.scrollLeft(),y:0,w:W.width(),h:W.height()}};F.originalUrl=window.location.href;F.overlayId="photoset-overlay";F.overlayWrap='<div id="'+F.overlayId+'"><div class="transparency"></div></div>';F.helpers.PhotosetOverlay={overlay:null,beforeLoad:function(opts){if(this.overlay){return}opts=$.extend(true,{speedIn:"fast",closeClick:true},opts);this.overlay=$(F.overlayWrap).appendTo("body");if(opts.closeClick){this.overlay.bind("click.fb",F.close)}this.overlay.fadeTo(opts.speedIn,opts.opacity)},beforeShow:function(opts){F.wrap.detach().appendTo("div#"+F.overlayId)},afterClose:function(opts){F.wrap.trigger("onReset").remove();if(this.overlay){this.overlay.remove();this.overlay=null}$.extend(F,{group:{},opts:{},current:null,isActive:false,isOpened:false,isOpen:false,wrap:null,outer:null,inner:null})}}})(jQuery,jQuery.fancybox);!function($){$.fn.notes=function(method){var methods;methods={};methods.init=function(options,editable,container){methods.setEditable(editable);return this.each(function(){var noteHolder,self;self=$(this);noteHolder=$('<div class="note-holder"></div>');return setTimeout(function(){var makeOptions,nfo,option,_i,_len,_results;nfo=methods.extractInfo(self,container);noteHolder.addClass(nfo.imgId);noteHolder.attr("id","holder_"+nfo.imgId);methods.placeNoteHolder(noteHolder,nfo);if(container!=null){container.append(noteHolder)}else{$("body").append(noteHolder)}if(methods.editable){noteHolder.css({"z-index":200});methods.bindNoteHolder(noteHolder)}makeOptions=function(opt){var literal;opt.parentWidth=nfo.width;opt.parentHeight=nfo.height;opt.noteHolder=noteHolder;literal=[opt];return methods.display.apply(self,literal)};if(options){_results=[];for(_i=0,_len=options.length;_i<_len;_i++){option=options[_i];_results.push(makeOptions(option))}return _results}},10)})};methods.extractInfo=function(elm,container){var compoundClass,eclass,height,imgId,offset,width;width=elm.width();height=elm.height();eclass=elm.attr("class");offset=container?elm.offsetParent().position():elm.offset();if(eclass!=null){compoundClass=eclass.indexOf(" ")}if(compoundClass!=null&&compoundClass!==-1){imgId=eclass.split(" ")[1]}else{imgId=eclass}return{width:width,height:height,offset:offset,imgId:imgId}};methods.placeNoteHolder=function(noteHolder,nfo){if(nfo!=null&&nfo.offset!=null){return noteHolder.css({left:nfo.offset.left+"px",top:nfo.offset.top+"px"})}};methods.buildNoteInfo=function(note,action){var data,height,hheight,holder,hwidth,imgId,left,pos,text,top,width;pos=note.position();holder=note.parent();hwidth=holder.width();hheight=holder.height();imgId=holder.attr("class").split(" ")[1].substring(3);data={};data.action=action;data.imageID=imgId;top=pos.top/hheight;left=pos.left/hwidth;width=note.width()/hwidth;height=note.height()/hheight;text=note.find("textarea").val();if(!text){text=note.find(".note-text-value").html()}if(text){data.text=text.replace(/\n/g,"<br/>").replace(/"/g,'\\"')}data.json='{"top":'+top+',"left":'+left+',"width":'+width+',"height":'+height+',"text":"'+data.text+'"}';return data};methods.add=function(note){var data;data=methods.buildNoteInfo(note,"ADD");return $.post("/ajax/imageNote",data,function(response){note.attr("id",response);note.find(".note-text").html(methods.buildTextNode(data.text.replace(/\\"/g,'"')));return methods.bind(note)},"text")};methods.buildTextNode=function(text){return $('<div class="note-text-value">'+text+'</div><a class="edit-note" href="#">edit</a>')};methods.buildEditNode=function(text,classname){text=text.replace(/<br>/g,"\n");if(!classname){return $("<textarea>"+text+'</textarea><br/><a class="delete little-button" href="#">delete</a><a class="save little-button" href="#">save</a>')}else{return $("<textarea>"+text+'</textarea><br/><a class="delete little-button" href="#">delete</a><a class="'+classname+' little-button" href="#">save</a>')}};methods.save=function(note){var data;data=methods.buildNoteInfo(note,"MODIFY");data.noteID=note.attr("id");if(data.noteID){return $.post("/ajax/imageNote",data,function(response){return methods.bind(note)})}};methods.update=function(note){var noteText,text;noteText=note.find(".note-text");text=noteText.find(".note-text-value").html();noteText.html(methods.buildEditNode(text,"edit"));methods.bind(note);return noteText.find("a.edit").click(function(evt){var data;evt.preventDefault();data=methods.buildNoteInfo(note,"MODIFY");if(data.text!=null){data.noteID=note.attr("id");return $.post("/ajax/imageNote",data,function(response){noteText.html(methods.buildTextNode(noteText.find("textarea").val()));return methods.bind(note)})}else{return feedBack.add("Please enter text in order to save.")}})};methods.remove=function(note){var data;data=methods.buildNoteInfo(note,"DELETE");data.noteID=note.attr("id");if(data.noteID){$.post("/ajax/imageNote",data)}return note.fadeOut(function(){return note.remove()})};methods.bindNoteHolder=function(holder){var note;note=null;$("div.note-holder").mousedown(function(evt){evt.preventDefault();note=methods.userCreateBox(evt,holder);return methods.bind(note,note.height())});return this};methods.display=function(note){var left,noteHeight,noteWidth,top;left=Math.round(note.parentWidth*note.left);top=Math.round(note.parentHeight*note.top);noteWidth=Math.round(note.parentWidth*note.width);noteHeight=Math.round(note.parentHeight*note.height);methods.drawBox({left:left,top:top,width:noteWidth,height:noteHeight,note:note});return this};methods.drawBox=function(opts){var note,noteid;noteid=opts.note.id?opts.note.id:opts.note.noteID;note=$('<div id="'+noteid+'" class="note-border"><div class="note-text"><div class="note-text-value">'+opts.note.text+"</div></div></div>");opts.note.noteHolder.append(note);if(methods.editable){note.find(".note-text").append('<a href="#" class="edit-note">edit</a>')}note.css({width:opts.width+"px",left:opts.left+"px",height:opts.height+"px",top:opts.top+"px"});methods.bind(note,opts.height);return this};methods.userCreateBox=function(evt,noteHolder){var note;note=$('<div class="note-border"><div class="note-text"></div></div>');note.find(".note-text").append(methods.buildEditNode(""));noteHolder.append(note);note.mousedown(function(md_evt){return md_evt.stopPropagation()});if(!/MSIE (\d+\.\d+);/.test(navigator.userAgent)){note.css({top:evt.layerY+"px",left:evt.layerX+"px",width:"50px",height:"50px"})}else{note.css({top:evt.offsetY+"px",left:evt.offsetX+"px",width:"50px",height:"50px"})}return note};methods.updateBoxSize=function(evt,note){var pos;pos=note.position();return note.css({width:Math.abs(pos.left+evt.layerX)+"px",height:Math.abs(pos.top+evt.layerY)+"px"})};methods.setNoteTextTop=function(noteText,height){return noteText.css({top:height+"px"})};methods.noteHover=function(note,height,noteText){var hovering,_self;_self=this;hovering=note.hover(function(){clearTimeout(_self.timer);methods.setNoteTextTop(noteText,height);$("div.note-text").hide();return noteText.show()},function(){clearTimeout(_self.timer);return _self.timer=setTimeout(function(){return noteText.fadeOut()},1500)});return hovering};methods.setEditable=function(bool){this.editable=bool;return this};methods.bind=function(note,height){var hovering,noteText,self;noteText=note.find("div.note-text");hovering=methods.noteHover(note,height,noteText);if(methods.editable){self=this;if(note.resizable!=null){note.resizable({containment:"parent",start:function(event,ui){noteText.hide();return note.unbind("hover",hovering)},resize:function(event,ui){noteText.hide();return note.unbind("hover",hovering)},stop:function(event,ui){height=note.height();hovering=methods.noteHover(note,height,noteText);methods.setNoteTextTop(noteText,height);methods.save(note);return noteText.show()}})}if(note.draggable!=null){note.draggable({containment:"parent",stop:function(event,ui){return methods.save(note)}})}note.mousedown(function(evt){return evt.stopPropagation()});noteText.find("a.save").click(function(evt){evt.preventDefault();return methods.add(note)});noteText.find("a.delete").click(function(evt){evt.preventDefault();return methods.remove(note)});return noteText.find("a.edit-note").click(function(evt){evt.preventDefault();return methods.update(note)})}};if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{return $.error("Method "+method+" does not exist on jQuery.notes")}}}(window.jQuery);(function($,_,Backbone){var defaults={width:"100%",gutter:"0px",maxRowsVisible:null};function Photoset(element,options){this.$element=$(element);this.photosetItems=[];this.photosetRws=[];this.rows=[];this.options=$.extend({},defaults,options);this.gutterVal=parseInt(this.options.gutter,10);this.init()}Photoset.prototype={init:function(){this.setupLayout(this.$element,this.options)},getRowCount:function(){return this.rows.length},setupLayout:function($elem,options){var self=this;this.photosetItems=$elem.find(".photoset-item");this.setupRows($elem,options);this.processRows($elem,options);this.processColumns($elem,options);_.defer(function(){$elem.trigger("photoset.imageloaded",$elem.find("img:not(.lazy-img)"))});this.resizePhotosetGrid();$(window).on("resize",_.debounce(function(){self.resizePhotosetGrid()},1e3));this.showHiddenRowsUpToMaxRowsVisible();$elem.find(".lazy-img").show().lazyload({effect:"fadeIn",threshold:200,load:function(){$elem.trigger("photoset.imageloaded",$(this))}})},setupRows:function(){var rows=[],segments=this.mapPhotosetItemsByContiguousType();_.each(segments,function(segment){if(segment.type==="image"){this.setupPhotosetImageRows(rows,$(segment.items))}else{this.setupPhotosetVideoRows(rows,$(segment.items))}},this);this.rows=rows},mapPhotosetItemsByContiguousType:function(){return _.reduce(this.photosetItems,function(memo,photosetItem){var $photosetItem=$(photosetItem),itemType=$photosetItem.hasClass("photoset-image")?"image":"video",lastSegment=_.last(memo);if(_.isEmpty(lastSegment)){memo.push({type:itemType,items:[photosetItem]})}else{if(lastSegment.type===itemType){lastSegment.items.push(photosetItem)}else{memo.push({type:itemType,items:[photosetItem]})}}return memo},[])},setLazyloadPropertiesForImage:function($imgItem,imageSize){var $img=$imgItem.find("img");$img.attr("data-original",$img.data(imageSize))},setLazyloadPropertiesForImages:function($imgItems,beginIndex,endIndex,imageSize){for(var i=beginIndex;i<=endIndex;i++){this.setLazyloadPropertiesForImage($imgItems.eq(i),imageSize)}},setupPhotosetVideoRows:function(rows,$videoItems){var self=this;$videoItems.each(function(){rows.push(1)})},setupPhotosetImageRows:function(rows,$imageItems){var numImages=$imageItems.length;if(numImages<=6){rows.push(1);this.setLazyloadPropertiesForImage($imageItems.eq(0),"medium-image");if(numImages==2){rows.push(1);this.setLazyloadPropertiesForImage($imageItems.eq(1),"medium-image")}else if(numImages==3){rows.push(2);this.setLazyloadPropertiesForImages($imageItems,1,2,"medium-image")}else if(numImages==4){rows.push(3);this.setLazyloadPropertiesForImages($imageItems,1,3,"small-image")}else if(numImages==5){rows.push(2,2);this.setLazyloadPropertiesForImages($imageItems,1,4,"medium-image")}else if(numImages==6){rows.push(2,3);this.setLazyloadPropertiesForImages($imageItems,1,2,"medium-image");this.setLazyloadPropertiesForImages($imageItems,3,5,"small-image")}}else{var partitions=parseInt($imageItems.length/6);for(var i=0;i<partitions;i++){this.setupPhotosetImageRows(rows,$imageItems.slice(i*6,(i+1)*6))}var rem=$imageItems.length%6;if(rem>0){this.setupPhotosetImageRows(rows,$imageItems.slice($imageItems.length-rem))}}},processRows:function($elem,options){var $items=this.photosetItems,itemIndex=0;$.each(this.rows,function(i,val){var rowStart=itemIndex,rowEnd=itemIndex+val,$itemSlice=$items.slice(rowStart,rowEnd),itemsCount=$itemSlice.length,rowHiddenClass=$itemSlice.hasClass("hidden-item")?"hidden-row":"";var $photosetRow=$('<div class="photoset-row">').addClass("cols-"+val).addClass(rowHiddenClass);$itemSlice.wrapAll($photosetRow);$itemSlice.removeClass("hidden-item");itemIndex=rowEnd});$elem.find(".photoset-row:not(:last-child)").css({"margin-bottom":options.gutter});this.photosetRows=$elem.find(".photoset-row")},processColumns:function($elem,options){var $rows=this.photosetRows,$items=this.photosetItems;$items.each(function(){$(this).wrapAll('<div class="photoset-cell" />')});var $cols1=$elem.find(".cols-1 .photoset-cell"),$cols2=$elem.find(".cols-2 .photoset-cell"),$cols3=$elem.find(".cols-3 .photoset-cell");$cols2.css({width:"50%"});$cols3.css({width:"33.3%"});$elem.find(".photoset-cell:not(:last-child)").css({"padding-right":this.gutterVal/2+"px"});$elem.find(".photoset-cell:not(:first-child)").css({"padding-left":this.gutterVal/2+"px"})},resizePhotosetGrid:function(){var self=this,$elem=this.$element,photosetWidth=$elem.width().toString(),$rows=this.photosetRows;if(photosetWidth!==$elem.data("width")){$elem.trigger("photoset.beforeResize");$rows.each(function(){var $row=$(this),$cells=$row.find(".photoset-cell"),$items=$row.find(".photoset-item");if($row.hasClass("cols-1")){var $img1=$row.find("img:eq(0)");if("none"===$img1.css("maxWidth")){$img1.css("maxWidth",$img1.data("orig-width")+"px")}}if($row.hasClass("cols-2")){var $img1=$row.find("img:eq(0)"),$img2=$row.find("img:eq(1)"),aspect1=$img1.data("orig-width")/$img1.data("orig-height"),aspect2=$img2.data("orig-width")/$img2.data("orig-height"),aspectTotal=aspect1+aspect2,percentWidth1=aspect1/aspectTotal*100;percentWidth2=aspect2/aspectTotal*100;$cells.eq(0).css({width:percentWidth1+"%"});$cells.eq(1).css({width:percentWidth2+"%"})}if(!$row.hasClass("cols-1")){var shortestImgHeight=1e5;$row.find("img").each(function(){var $candidateImg=$(this),candidateImgHeight=self.getHeightProportionalToCellWidth($candidateImg,photosetWidth);if(candidateImgHeight<shortestImgHeight){shortestImgHeight=candidateImgHeight}});$row.height(shortestImgHeight);$items.height(shortestImgHeight);$row.find("img").each(function(){var $img=$(this),imgHeight=self.getHeightProportionalToCellWidth($img,photosetWidth);var marginOffset=(shortestImgHeight-imgHeight)*.5+"px";$img.css({"margin-top":marginOffset})})}});$elem.data("width",photosetWidth);$elem.trigger("photoset.afterResize")}},getHeightProportionalToCellWidth:function($img,photosetWidth){var parentCellPercentageWidth=$img.closest(".photoset-cell").width(),parentCellProportialWidth=parentCellPercentageWidth/100*(photosetWidth-this.gutterVal*2);return Math.floor($img.data("orig-height")/$img.data("orig-width")*parentCellProportialWidth)},showHiddenRowsUpToMaxRowsVisible:function(){var maxRowsVisible=this.options.maxRowsVisible,shouldHideRows=maxRowsVisible&&this.getRowCount()>maxRowsVisible,$elem=this.$element,$rows=null,self=this;if(!shouldHideRows){this.$element.find(".hidden-row").removeClass("hidden-row")}else{$rows=$elem.find(".photoset-row");for(var i=0;i<maxRowsVisible;i++){$rows.eq(i).removeClass("hidden-row")}}},showAllRows:function(){this.$element.find(".hidden-row").removeClass("hidden-row");$("html,body").animate({scrollTop:$(window).scrollTop()+1},100)}};$.fn.photoset=function(options){return this.each(function(){var $this=$(this),data=$this.data("photoset");if(!data)$this.data("photoset",data=new Photoset(this,options));if(typeof options=="string")data[option].call($this)})}})(jQuery,_);Ibles.package("Ibles.views");Ibles.views.PhotosetView=Backbone.View.extend({events:{"click a.photoset-link":"photosetLinkClicked","hover a.photoset-link":"mouseHoverLink","click a.photoset-showmore":"showAllPhotosetRows"},initialize:function(options){_.bindAll(this,"beforePhotosetResize","afterPhotosetResize","renderImageNotes");this.$el.photoset(options);this.maxRowsVisible=options.maxRowsVisible;this.photoset=this.$el.data("photoset");this.enableShowMoreToggle();this.bindEvents()},bindEvents:function(){this.$el.on("photoset.beforeResize",this.beforePhotosetResize);this.$el.on("photoset.afterResize",this.afterPhotosetResize);this.$el.on("photoset.imageloaded",this.renderImageNotes)},enableShowMoreToggle:function(){var maxRowsVisible=this.maxRowsVisible;if(maxRowsVisible){if(this.photoset.getRowCount()>maxRowsVisible){this.$el.find(".photoset-showmore").css({display:"block"})}}},renderImageNotes:function(event,images){var $images=$(images);$images.each(function(){var $image=$(this),notesContainer=$image.closest(".photoset-cell"),imageNotes=$image.data("notes"),imageId=$image.data("image-id");if($image.closest(".photoset-row").children().size()===1){if(imageNotes&&imageNotes.length){$image.addClass("photo img"+imageId);$image.notes(imageNotes,false,notesContainer)}}})},beforePhotosetResize:function(){this.$el.find(".note-holder").remove()},afterPhotosetResize:function(){this.renderImageNotes()},showAllPhotosetRows:function(e){e.preventDefault();this.$el.find(".photoset-showmore").hide();this.photoset.showAllRows()},photosetLinkClicked:function(e){e.preventDefault();new Ibles.views.PhotosetOverlay({el:this.el})},mouseHoverLink:function(e){e.preventDefault();$(e.currentTarget).toggleClass("selected")}});Ibles.views.PhotosetOverlay=Backbone.View.extend({initialize:function(){this.render()},render:function(){var $photosetLinks=this.$el.find(".photoset-link"),self=this;if(!this.processedPhotosetLinks){_.each($photosetLinks,function(link){var $link=$(link);$link.data("original-href",$link.attr("href"));$(link).attr("href",$(link).data("fancybox-href"))});this.processedPhotosetLinks=true}$photosetLinks.fancybox({afterShow:function(){var $fancyBoxInner=$(".fancybox-inner"),$currentLink=$(this.element);if($fancyBoxInner.length){var galleryImg=$fancyBoxInner.find("img:first"),notesJson=$currentLink.find("img:first").data("notes");if(notesJson){galleryImg.notes(notesJson,false,$fancyBoxInner)}$fancyBoxInner.find(".fancybox-image").one("click",function(e){window.location.href=$currentLink.data("original-href")})}}})}});Ibles.package("Ibles.models","Ibles.collections");Ibles.collections.FileSet=Backbone.Collection.extend({model:Backbone.Model,idArray:function(){return this.map(function(file){return{id:file.get("id")}})}});Ibles.package("Ibles.models","Ibles.collections");Ibles.models.CommentModel=Backbone.Model.extend({defaults:function(){return{instructableId:Ibles.pageContext.ibleData.id,author:Ibles.session.get("screenName"),authorId:Ibles.session.get("id"),avatar:Ibles.session.get("tinyUrl"),fileSet:Ibles.pageContext.mobile||!Ibles.session.authenticated()?new Ibles.collections.FileSet:new ibles.FileSet,IMadeIt:false,replyAuthor:null,quarantine:false,limbo:false,status:null}},initialize:function(){if(!_.isUndefined(this.get("publishDate"))){this.set({commentTime:this.setRelDate()})}if(_.isUndefined(this.get("authorUrl"))){this.set({authorUrl:Ibles.reverseUrls.memberUrl(this.get("author"))})}if(!_.isEmpty(this.get("files"))){this.get("fileSet").add(this.get("files"))}if(this.get("status")==="DELETED"){this.setDeletedBody()}},setRelDate:function(){var publishDate=this.get("publishDate");var pubDate=new Date(publishDate),newDate=new Date(moment());if(pubDate>newDate){return Ibles.attemptTranslationOfString("a few seconds ago")}else{return moment(publishDate).fromNow()}},setDeletedBody:function(){this.set({body:Ibles.attemptTranslationOfString("(removed by author or community request)")})},postCommentAction:function(){var that=this,params=_.pick(this.toJSON(),"instructableId","author","IMadeIt","body","inReplyTo"),promise,fileSet=this.get("fileSet");
if(!fileSet.isEmpty()){if(_.isFunction(fileSet.idArray)){params.images=fileSet.idArray()}else{params.images=fileSet.map(function(file){return{id:file.get("id")}})}}promise=Ibles.API.jsonPostRequest("addComment",params,{success:function(data){that.set({id:data["id"],commentTime:"a few seconds ago",publishDate:moment().fromNow()});if(_.isUndefined(that.get("inReplyTo"))){Ibles.COMMENTCOLLECTION.add(that,{at:0})}else{Ibles.COMMENTCOLLECTION.add(that,{at:Ibles.COMMENTCOLLECTION.findIndexOfComment(that.get("inReplyTo"))+1});Ibles.COMMENTCOLLECTION.dirtyTree=true}},error:function(data){var errorMessage;if(data&&data["validationErrors"]){var errorKeys=Object.keys(data.validationErrors);if(errorKeys.length>1){errorMessage=Ibles.locale.errors.incompleteFormError}else{errorMessage=data.validationErrors[errorKeys[0]]}}else{errorMessage=Ibles.toLocaleError(data,Ibles.locale.errors.somethingWentWrong)}that.trigger("comment.postError",errorMessage)}},"id");return promise},deleteComment:function(){var that=this;return Ibles.API.postRequest("deleteComment",{id:this.get("id")},{success:function(data){if(that.collection.getChildrenArray(that).length>0){that.setDeletedBody()}else{that.collection.remove(that)}}})},deleteThread:function(){var that=this;return Ibles.API.postRequest("deleteThread",{id:this.get("id")},{success:function(data){that.collection.deleteThread(that)}})},setIMadeIt:function(value){var options={id:this.get("id"),value:value},promise=$.ajax({url:"/json-api/setIMadeIt",dataType:"json",type:"POST",data:options});return promise},flagComment:function(flagName){var self=this,params={id:this.get("id"),flag:flagName};return Ibles.API.postRequest("setFlag",params)},limbo:function(){var params={action:"LIMBO",objectIds:this.get("id"),type:"C"},that=this;return Ibles.API.adminAjaxRequest("quarantine",params,{success:function(data){that.set({limbo:true})}})},unquarantine:function(){var params={action:"PUBLISH",objectIds:this.get("id"),type:"C"},self=this;return Ibles.API.adminAjaxRequest("quarantine",params,{success:function(data){self.set({quarantine:false,status:"PUBLISHED"})}})},toggleStickyComment:function(sticky){var params={entryID:this.get("id"),type:"FORUM_COMMENT"},that=this;return Ibles.API.ajaxRequest("sticky",params,{success:function(data){that.set({sticky:sticky})}})},toggleApproval:function(checked){var status=checked===true?"CHECKED":"UNCHECKED",params={entryID:this.get("id"),status:status},that=this;return Ibles.API.ajaxRequest("approve",params,{success:function(data){that.set({approved:checked})}})}});Ibles.collections.CommentCollection=Backbone.Collection.extend({numCommentsToLoad:50,dirtyTree:false,model:Ibles.models.CommentModel,initialize:function(){_.bindAll(this,"deleteThread","getChildrenArray")},findIndexOfComment:function(id){return this.indexOf(this.findWhere({id:id}))},deleteThread:function(model){var children=this.getChildrenArray(model),parents=this.getParents(model);this.remove(children);this.remove(model);this.remove(parents)},parseComments:function(comments){return _.map(comments,function(comment){if(_.isUndefined(comment.author)){comment.author=null;comment.authorUrl="/"}return comment})},fetchComments:function(){if(!this.dirtyTree){var that=this,id=Ibles.pageContext.ibleData.id,deferred=Ibles.API.getRequest("getComments",{instructableId:id,limit:this.numCommentsToLoad,offset:this.length},{success:function(data){that.add(that.parseComments(data.comments))}});return deferred}else{return this.reloadCommentTree()}},reloadCommentTree:function(){var that=this,id=Ibles.pageContext.ibleData.id,deferred=Ibles.API.getRequest("getComments",{instructableId:id,limit:this.numCommentsToLoad+this.length,offset:0},{success:function(data){that.reset(that.parseComments(data.comments))}});return deferred},getParents:function(model){var that=this,parents=[],getParent=function(model){var parentId=model.get("inReplyTo");if(!_.isUndefined(parentId)){parents.push(parentId);getParent(that.get(parentId))}else{return parents}};return getParent(model)},getChildrenArray:function(model){var that=this,children=[],getChildren=function(model){var levelChildren=that.where({inReplyTo:model.get("id")});if(levelChildren.length>0){children=children.concat(_.pluck(levelChildren,"id"));_.each(levelChildren,getChildren)}};getChildren(model);return children}});Ibles.package("Ibles.views");Ibles.views.CommentManager=Backbone.View.extend({el:"#commentsWrapper",events:{"click #see-more-comments":"addComments"},initialize:function(){_.bindAll(this,"addComments","renderComment");var that=this;this.$("#loaded-comments").remove();window.Ibles.COMMENTCOLLECTION=new Ibles.collections.CommentCollection;this.collection=window.Ibles.COMMENTCOLLECTION;window.Ibles.ACHIEVEMENTS=new Ibles.models.Achievements;this.achievements=window.Ibles.ACHIEVEMENTS;sessionReady(function(){that.addComments();new Ibles.views.CommentPostingView});this.listenTo(this.collection,"add",this.renderComment);this.listenTo(this.collection,"reset",this.reRenderAllComments)},addComments:function(){var that=this;this.achievements.clearAuthors();this.collection.fetchComments().done(function(data){if(data.comments.length<that.collection.numCommentsToLoad){$("#see-more-comments").hide()}that.achievements.fetch();that.trigger("commentsRendered")})},renderComment:function(comment){var view=new Ibles.views.CommentView({model:comment}),comments=this.$("#comment-list .comment-container"),commentIndex=comment.collection.indexOf(comment);if(commentIndex===0){$("#comment-list").prepend(view.render())}else if(commentIndex===comments.length){$("#comment-list").append(view.render())}else{comments.eq(commentIndex).before(view.render())}},reRenderAllComments:function(){this.$("#comment-list").css({"min-height":$("#comment-list").outerHeight()});this.$("#comment-list").empty();this.collection.each(this.renderComment);this.$("#comment-list").css({"min-height":"initial"})}});Ibles.views.CommentView=Backbone.View.extend({quarantineMessage:"THIS COMMENT HAS BEEN QUARANTINED",className:function(){if(_.isUndefined(this.model.get("inReplyTo"))){return"comment-container clearfix"}else{return"comment-container reply clearfix"}},template:_.template(Ibles.JST["comment-list-item"]),imageTemplate:_.template(Ibles.JST["comment-image-file"]),fileTemplate:_.template(Ibles.JST["comment-attached-file"]),events:{"click .replyToCommentBtn":"renderReplyUI","click .imadeit-check":"setIMadeItAction","click .deleteComment":"deleteCommentAction","click .deleteThread":"deleteThreadAction","click .flagComment .dropdown-menu a":"flagComment","click .limboBtn":"limboComment","click .unquarantine-btn":"unquarantineComment","click .sticky-check":"toggleSticky","click .approved-check":"toggleApproval","click .reply-to":"scrollToParent"},initialize:function(){_.bindAll(this,"remove");this.setUpAchievements();this.listenTo(this.model,"change",this.render);this.listenTo(this.model,"remove",this.remove)},setUpAchievements:function(){this.achievents=window.Ibles.ACHIEVEMENTS;this.achievents.addAuthor(this.model.get("authorId"))},render:function(){this.$el.html(this.template(this.model.toJSON()));if((this.model.get("limbo")||this.model.get("quarantine")&&!Ibles.session.isAdmin())&&this.model.get("author")!==Ibles.session.get("screenName")){this.$el.hide()}if(Ibles.session.isAdmin()){this.$(".deleteComment,.deleteThread,.imadeit-checkbox,.limboBtn,.sticky-comment-checkbox,.approved-checkbox").show();if(this.model.get("quarantine")){this.$(".quarantine-message").html(this.quarantineMessage);this.$(".unquarantine-btn").show()}}else if(Ibles.session.authenticated()){this.$(".flagComment").show()}if(this.model.get("author")===Ibles.pageContext.ibleData.author.screenName){this.$(".is-author").show();this.$(".comment").addClass("highlight")}if(this.model.get("author")===Ibles.session.get("screenName")){this.$(".deleteComment, .sticky-comment-checkbox").show()}if(!this.model.get("fileSet").isEmpty()){this.renderFiles()}else{this.$(".comment-files,.comment-photos").hide()}if(this.model.get("IMadeIt")===true){this.$(".comment-author").addClass("imadeit");this.$(".imadeit-check").prop("checked",true);this.$(".made-it-header").show()}if(this.model.get("sticky")===true){this.$(".sticky-check").prop("checked",true)}if(this.model.get("approved")===true){this.$(".approved-check").prop("checked",true)}if(!_.isUndefined(this.model.get("inReplyTo"))&&_.isNull(this.model.get("replyAuthor"))){this.model.set({replyAuthor:this.model.collection.get(this.model.get("inReplyTo")).get("author")})}this.attachAuthorAchievements();this.attachStatsCard();this.attachCommentImagesFancybox();return this.$el},attachAuthorAchievements:function(){var self=this;var authorId=this.model.get("authorId");this.achievents.fetchForAuthor(authorId).done(function(authorStats){var achievementView=new Ibles.views.Achievement({model:new Backbone.Model(_.extend(authorStats,{authorId:authorId}))});self.$(".achievement-holder").html(achievementView.render().el);if(self.$(".author-achievements").is(":visible")){self.$(".imadeit").addClass("has-achievement")}})},attachStatsCard:function(){this.$(".memberstats").statscard({loginURL:"/account/login",screenName:this.model.get("author")})},renderFiles:function(){var imageTemplate=this.imageTemplate,fileTemplate=this.fileTemplate,that=this;this.model.get("fileSet").each(function(file){file.set({commentId:that.model.get("id")});if(_.isUndefined(file.get("height"))){that.$(".comment-files").append(fileTemplate(file.toJSON()))}else{that.$(".comment-photos").append(imageTemplate(file.toJSON()))}})},renderReplyUI:function(e){e.preventDefault();if(Ibles.session.authenticated()){$(".comment-container .post-comment-container").remove();var reply=new Ibles.models.CommentModel({inReplyTo:this.model.get("id"),replyAuthor:this.model.get("author")}),replyView=new Ibles.views.ReplyPostingView({model:reply});this.$(".comment").after(replyView.render());$("html, body").animate({scrollTop:this.$el.offset().top},1e3)}else{$("#loginModal").modal("show")}},setIMadeItAction:function(e){var that=this;this.showRequestFeedback(this.model.setIMadeIt(this.$(".imadeit-check").is(":checked")))},deleteCommentAction:function(e){var response=confirm(Ibles.attemptTranslationOfString("Are you sure you want to delete this comment?"));if(response){this.showRequestFeedback(this.model.deleteComment())}},deleteThreadAction:function(){var response=confirm(Ibles.attemptTranslationOfString("Are you sure you want to delete this thread?"));if(response){this.showRequestFeedback(this.model.deleteThread())}},flagComment:function(e){this.showRequestFeedback(this.model.flagComment($(e.currentTarget).data("flagname")))},limboComment:function(e){this.showRequestFeedback(this.model.limbo())},unquarantineComment:function(e){this.showRequestFeedback(this.model.unquarantine())},toggleSticky:function(e){this.showRequestFeedback(this.model.toggleStickyComment($(e.currentTarget).prop("checked")))},toggleApproval:function(e){this.showRequestFeedback(this.model.toggleApproval($(e.currentTarget).prop("checked")))},showRequestFeedback:function(promise){var that=this;this.$(".request-img").show();promise.then(function(){that.$(".request-img").hide();that.$(".request-success").show();that.$(".request-success").fadeOut()}).fail(function(){that.$(".request-img").hide();that.$(".request-failure").show();that.$(".request-failure").fadeOut()})},scrollToParent:function(e){e.preventDefault();if(!_.isUndefined(this.model.get("inReplyTo"))){var $parent=$("#comment-"+this.model.get("inReplyTo")),scrollPos=$parent.offset().top-$("#ible-header.fixed").outerHeight();if(scrollPos<window.scrollTop){$("body,html").animate({scrollTop:scrollPos},"fast")}}},attachCommentImagesFancybox:function(){this.$(".comment-photos-link").fancybox()}});Ibles.views.BaseCommentPostingView=Backbone.View.extend({events:{"click .post-comment-btn":"sendComment","click .addCommentImages":"attemptUpload","click .comment-imadeit-toggle":"toggleIMadeIt"},render:function(){this.$el.html(this.template(this.model.toJSON()));this.addRedactorAirMode();this.files=this.$(".commentFiles");this.imagebucket=this.$(".instructable-image-bucket");this.imagebucket.hide();return this.$el},sendComment:function(e){e.preventDefault();var bodyText=this.$(".postCommentBody").val();this.model.set({body:bodyText.replace(/\n/g,"<br>")});if(!_.isEmpty(this.files.val())&&!this.model.get("IMadeIt")){this.showImadeItPrompt()}else{this.postComment()}},postComment:function(){this.model.postCommentAction().then(this.onSend)},showImadeItPrompt:function(){var self=this;new Ibles.views.ImadeItConfirmModal({model:this.model,selectionCallback:function(){self.postComment()}}).render()},showPostingError:function(model,options){var errorMessage=options["message"];this.$(".error-box").text(errorMessage).removeClass("hide")},toggleIMadeIt:function(e){},addRedactorAirMode:function(){var self=this;head.load("/static/drag_editor/dependencies/redactorInstructables/redactor_air_instructables.5.js",function(){loadRedactorAir(self.$(".redactorAirComment"),{callback:function(){var toolTip=self.$(".comment-tip");toolTip.tooltip();self.$(".redactor_redactorAirComment").on("click",function(){Ibles.authFlow.checkLoginThen(function(){toolTip.tooltip("show");setTimeout(function(){self.hideToolTip()},3e3)})})}})})},attemptUpload:function(e){e.preventDefault();var self=this;Ibles.authFlow.checkLoginThen(function(){self.showUploader()})},showUploader:function(){this.model.get("fileSet").bind("add remove",this.syncFileCommentFiles);var fileSetView=new window.ibles.InstructableFileSetView({collection:this.model.get("fileSet"),el:this.imagebucket,fileConstructor:window.ibles.CommentFileView});fileSetView.makeDroppable();this.uploader=new window.ibles.uploadModalView({collection:this.model.get("fileSet")});this.$(".fileset_placeholder_holder").hide()},syncFileCommentFiles:function(){this.files.val("");_.each(this.model.get("fileSet").models,function(file){this.addFileToInput(file)},this);if(this.model.get("fileSet").length>0){this.imagebucket.fadeIn()}else{this.imagebucket.fadeOut()}},addFileToInput:function(file){var files=this.files.val();if(files!==""){this.files.val(files+" "+file.get("id"))}else{this.files.val(file.get("id"))}return this},hideToolTip:function(){this.$(".comment-tip").tooltip("hide");this.$(".redactor_redactorAirComment").off("click")},showPostingError:function(errorMessage){var alert=new Ibles.models.AlertModel({alertType:"error",alertMessage:errorMessage});new Ibles.views.AlertLabelView({el:this.$(".comment-error"),model:alert})},showOrHideFileView:function(){if(this.model.get("fileSet").isEmpty()){this.imagebucket.hide()}else{this.imagebucket.show()}}});Ibles.views.ReplyPostingView=Ibles.views.BaseCommentPostingView.extend({template:_.template(Ibles.JST["post-comment"]),initialize:function(){_.bindAll(this,"sendComment","onSend","syncFileCommentFiles");this.listenTo(this.model,"comment.postError",this.showPostingError);this.listenTo(this.model.get("fileSet"),"add remove",this.showOrHideFileview)},onSend:function(){this.$el.remove();window.Ibles.ACHIEVEMENTS.fetch()}});Ibles.views.CommentPostingView=Ibles.views.BaseCommentPostingView.extend({el:"#topLevelCommentField",template:_.template(Ibles.JST["post-comment-top-level"]),initialize:function(){_.bindAll(this,"sendComment","onSend","syncFileCommentFiles");this.model=new Ibles.models.CommentModel;this.render();this.listenTo(this.model,"change:IMadeIt",this.updateIMadeItButton);this.listenTo(this.model.get("fileSet"),"add remove",this.showOrHideFileview);this.listenTo(this.model,"comment.postError",this.showPostingError)},toggleIMadeIt:function(e){var that=this;e.preventDefault();Ibles.authFlow.checkLoginThen(function(){that.model.set({IMadeIt:!that.model.get("IMadeIt")})})},updateIMadeItButton:function(){var that=this;if(this.model.get("IMadeIt")){this.$(".comment-imadeit-toggle").addClass("active");if(this.model.get("fileSet").isEmpty()){this.$(".imadeit-image-warning").show();this.$(".imadeit-image-warning button.close").click(function(e){that.$(".imadeit-image-warning").hide()})}}else{this.$(".comment-imadeit-toggle").removeClass("active")}},onSend:function(){this.undelegateEvents();this.$el.empty();this.stopListening();new Ibles.views.CommentPostingView}});Ibles.views.ImadeItConfirmModal=Backbone.View.extend({className:"imadeit-modal modal hide fade",model:null,template:_.template(Ibles.JST["imadeit-modal"]),events:{"click .imadeit-yes":"setImadeIt","click .imadeit-no":"unsetImadeIt"},initialize:function(options){this.selectionCallback=options&&options.selectionCallback;this.$el.html(this.template());$("body").append(this.$el)},setImadeIt:function(e){e.preventDefault();this.model.set({IMadeIt:true});this.afterToggle()},unsetImadeIt:function(e){e.preventDefault();this.model.set({IMadeIt:false});this.afterToggle()},afterToggle:function(){this.$el.modal("hide");if(_.isFunction(this.selectionCallback))this.selectionCallback()},render:function(){var self=this;this.$el.one("hidden.bs.modal",function(e){self.remove()});this.$el.modal("show")}});Ibles.package("Ibles.models");Ibles.models.InstructableModel=Backbone.Model.extend({defaults:function(){return{id:null,title:null,urlString:null,fullUrl:null,author:null,type:null,status:null,category:null,channel:null,publishDate:null,favorite:false,flagged:false,votableContests:[]}},initialize:function(data){this.set({favorite:data.favorite,fullUrl:Ibles.pageContext.remoteRoot.slice(0,-1)+Ibles.reverseUrls.ibleUrl(this.get("urlString"))});this.getStats()},flagAction:function(){var self=this;return Ibles.API.ajaxRequest("flag",{entryID:this.get("id"),action:"SET",flag:this.get("flaggedAs")},{success:function(){self.set({flagged:true})}})},favoriteAction:function(){var self=this;return Ibles.API.ajaxRequest("favorite",{entryId:this.get("id")},{success:function(){self.set({favorite:!self.get("favorite")})}})},isFavorite:function(){var self=this;return Ibles.API.getRequest("isFavorite",{id:this.get("id")},{success:function(data){self.set({favorite:data["isFavorite"]})}})},getStats:function(){var that=this;return Ibles.API.getRequest("getIbleStats",{id:this.get("id")},{success:function(data){that.set(data)}},["views","favorites","comments"])},toJSON:function(){var json=Backbone.Model.prototype.toJSON.apply(this,arguments);json.url=Ibles.reverseUrls.ibleUrl(json.id);return json}});Ibles.models.VotableContestModel=Backbone.Model.extend({defaults:{id:null,ibleId:null,title:null,urlString:null,votedFor:false,squareUrl:null,thumbUrl:null},vote:function(onCompletion){var that=this;Ibles.API.contestAjaxRequest("vote",{contestId:this.get("id"),instructableId:this.get("ibleId"),posted:(new Date).getTime(),add:!this.get("votedFor")},{success:function(){that.set({votedFor:!that.get("votedFor")})},complete:function(){if(_.isFunction(onCompletion))onCompletion()}})}});Ibles.package("Ibles.models");Ibles.models.AuthorModel=Backbone.Model.extend({defaults:{screenName:null,following:false},followAction:function(){var method=this.get("following")?"unfollowAuthor":"followAuthor",screenName=this.get("screenName"),self=this;return Ibles.API.postRequest(method,{screenName:screenName},{success:function(response){if(response["message"].indexOf("You are now following")!=-1){self.set({following:true})}else if(response["message"].indexOf("You are no longer following")!=-1){self.set({following:false})}}})},isFollowing:function(){var self=this;return Ibles.API.getRequest("isFollowing",{screenName:this.get("screenName")},{success:function(data){self.set({following:data["isFollowing"]})}})}});Ibles.package("Ibles.views");Ibles.views.InstructableView=Backbone.View.extend({commentsManager:null,ibleModel:null,authorModel:null,session:null,events:{"click .favorite-btn":"attemptFave","click .follow-btn":"attemptFollow","click .share-btn":"toggledShareMenu","click #steps-nav-toggle":"toggleStepsNav","click .google-share-button":"shareOnGPlus","click .facebook-share-button":"shareOnFacebook","click .flag-as-btn":"attemptFlag","click .add-to-collection-btn":"showAddToCollectionModal","click #more-stats-btn":"showStatsModal","click #imadeit-btn":"scrollToCommentAndToggleImadeIt","click #add-to-contest-btn":"showAddToContestModal","click #add-to-group-btn":"showAddToGroupModal","click .view-all-steps-btn":"toggleAllSteps","click #print-it-btn":"printIt"},initialize:function(opts){this.opts=opts;this.setupTemplates();this.session=Ibles.session;this.setupCommonSubviewsAndModels();this.setupStickyAds();this.setupPhotosets();this.setupStickyHeader();this.setupPdfDownload();this.setUpCategoryTracking();this.setupGtmDataLayer();this.setupShareMenu();this.fetchUserInstructableData();this.render()},fetchUserInstructableData:function(){var self=this;if(this.session.authenticated()){$.ajax({url:"/json-api/showInstructableUserData",data:{id:Ibles.pageContext.ibleData.id},cache:false,success:function(data){_.extend(Ibles.pageContext.ibleData,data);self.ibleModel.set(data);self.authorModel.set({following:data.following});self.setupUserSpecificViewsAndModels()}})}},setupUserSpecificViewsAndModels:function(){this.setupVoting();this.setupAdminPanel()},setupTemplates:function(){if(Ibles.pageContext.ibleData.type!=="Guide"){this.featuredByTemplate=_.template(Ibles.JST["featured-by"]);this.postedDateTemplate=_.template(Ibles.JST["posted-date"])}},setupCommonSubviewsAndModels:function(){var ibleData=Ibles.pageContext.ibleData,opts=this.opts;this.allSteps=opts.allSteps;this.ibleModel=new Ibles.models.InstructableModel(ibleData);this.authorModel=new Ibles.models.AuthorModel(ibleData.author);this.listenTo(this.ibleModel,"change:favorite",this.render);this.listenTo(this.authorModel,"change:following",this.render);this.listenTo(this.ibleModel,"change:comments change:favorites change:views",this.updateStats);this.setupComments()},setupPhotosets:function(){_.each(this.$(".photoset"),function($photoset){new Ibles.views.PhotosetView({el:$photoset,maxRowsVisible:2,gutter:"5px"})})},shouldShowAdminPanel:function(){var session=this.session;return session.isAdmin()||session.isStaff()||session.get("id")===this.authorModel.get("id")},setupAdminPanel:function(){if(this.shouldShowAdminPanel()){head.load(Ibles.assets.admin(),function(){new Ibles.views.Admin({el:"#admin-container"})})}},setupStickyHeader:function(){new Ibles.views.StickyHeader({el:".sticky-header"})},setupStickyAds:function(){var opts=this.opts;if(!opts||!opts.collection&&!opts.disableAds){if(!this.ibleModel.get("pgFlag")){new Ibles.views.StickyAdslot({el:"#ible-stickyad"})}}},setupVoting:function(){if(!_.isEmpty(this.ibleModel.get("votableContests"))){new Ibles.views.VotingDropdownMenu({el:"#vote-dropdown",model:this.ibleModel})}},setupPdfDownload:function(){new Ibles.views.PDFDownloadView({el:"#pdf-content"})},setupShareMenu:function(){new Ibles.views.IbleShareMenuView({model:this.ibleModel});if(Ibles.pageContext.ibleData.type!=="Guide"){new Ibles.views.SocialShareOverlayView({model:this.ibleModel,el:"body"})}},setupComments:function(){var self=this,opts=this.opts;if(!opts||!opts.disableComments){sessionReady(function(session){if(!session.authenticated()){self.createCommentManager()}else{self.fetchUploaderTemplates(function(){self.fetchUploaderScripts(_.bind(self.createCommentManager,self))})}})}},createCommentManager:function(){this.commentsManager=new Ibles.views.CommentManager;this.listenToOnce(this.commentsManager,"commentsRendered",_.bind(this.scrollToComment,this))},scrollToComment:function(){if(Ibles.Q("comments")==="all"){var hash=window.location.hash,commentId=hash&&hash.substr(1),commentContainer=commentId&&this.$("#comment-{0}".format(commentId)),commentsContainer=this.$("#comment-list"),scrollTop;if(commentContainer.length){scrollTop=commentContainer.offset().top}else{scrollTop=commentsContainer.offset().top}$("html, body").animate({scrollTop:scrollTop},1e3)}},shareOnGPlus:function(e){e.preventDefault();window.open($(e.currentTarget).attr("href"),"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600");return false},shareOnFacebook:function(e){if(!_.isUndefined(FB)){e.preventDefault();FB.ui({method:"share",href:this.ibleModel.get("fullUrl")})}},toggleStepsNav:function(e){e.preventDefault();var $ibleHeader=$("#ible-header"),$ibleStepsNav=$("#ible-steps-nav"),$toggleBtn=$("#steps-nav-toggle");$toggleBtn.toggleClass("active");$ibleStepsNav.toggleClass("expanded");$ibleHeader.parent().height($ibleHeader.outerHeight())},attemptFave:function(e){e.preventDefault();if(this.session.authenticated()){Ibles.alertWhenError(this.ibleModel.favoriteAction())}else{Ibles.authFlow.showLogin(e)}},attemptFollow:function(e){if(this.session.authenticated()){Ibles.alertWhenError(this.authorModel.followAction())}else{Ibles.authFlow.showLogin(e)}},attemptFlag:function(e){e.preventDefault();var ibleMod=this.ibleModel;Ibles.authFlow.checkLoginThen(function(){var target=$(e.target);var reasonText=target.text();var reason=target.attr("data-flag-as");new Ibles.views.ConfirmationView({model:new Ibles.models.ConfirmationModel({confirmationMessage:Ibles.attemptTranslationOfString(Ibles.locale.messages.confirmFlag.replace("<< reason >>",reasonText))}),callbackFn:function(){ibleMod.set("flaggedAs",reason);ibleMod.flagAction().success(Ibles.views.AlertView.callbackFactory("success")).error(Ibles.views.AlertView.callbackFactory("error"))}})})},showAddToCollectionModal:function(e){var self=this;Ibles.authFlow.checkLoginThen(function(){head.load(Ibles.assets.manageCollectionAssets(),$.proxy(self.renderAddToCollectionModal,self))})},renderAddToCollectionModal:function(){var self=this;if(!this.addToCollectionView){var $addBtn=$(".add-to-collection-btn");$addBtn.addClass("loading");var ible=Ibles.pageContext.ibleData;this.addToCollectionView=new Ibles.views.AddToCollectionView({ibleId:ible.id,ibleTitle:ible.title,ibleThumbUrl:ible.rectangle1Url});this.listenToOnce(this.addToCollectionView,"ready",function(){$addBtn.removeClass("loading")})}this.addToCollectionView.render()},showStatsModal:function(){var self=this;Ibles.authFlow.checkLoginThen(function(){head.load(Ibles.assets.analytics().concat("https://apis.google.com/js/platform.js"),function(){gapi.load("analytics",$.proxy(self.renderStatsModal,self))})})},renderStatsModal:function(){var self=this;if(!this.analyticsView){this.analyticsView=new Ibles.views.AnalyticsView({model:new Ibles.models.StatsModel(_.pick(self.ibleModel.attributes,"id","urlString","title","comments","favorites","views"))})}this.analyticsView.render()},showAddToContestModal:function(){var self=this;if(!this.addToContestView){this.addToContestView=new Ibles.views.AddToContestView({ibleData:Ibles.pageContext.ibleData})}this.addToContestView.render()},showAddToGroupModal:function(){var self=this;if(!this.addToGroupView){this.addToGroupView=new Ibles.views.AddToGroupView({ibleData:Ibles.pageContext.ibleData})}this.addToGroupView.render()},toggleAllSteps:function(e){e.preventDefault();var target=$(e.currentTarget),allstepsActive=target.hasClass("active"),ibleUrl=Ibles.reverseUrls.ibleUrl(Ibles.pageContext.ibleData.urlString);if(!this.session.authenticated()){window.location=allstepsActive?ibleUrl:"{0}?ALLSTEPS".format(ibleUrl)}else{document.cookie=allstepsActive?"ibleAllSteps=0; path=/":"ibleAllSteps=1; path=/";window.location=ibleUrl}},isViewedByAuthor:function(){return this.session.authenticated()&&this.session.get("screenName")===this.authorModel.get("screenName")},render:function(){var loggedIn=this.session.authenticated(),isAdmin=loggedIn&&this.session.isAdmin(),isIbleAuthor=this.isViewedByAuthor(),isFavorite=this.ibleModel.get("favorite"),isFollowingAuthor=this.authorModel.get("following");if(isFavorite){$(".favorite-btn").addClass("active");$(".fave-btn-txt").html("Favorited")}else{$(".favorite-btn").removeClass("active");$(".fave-btn-txt").html("Favorite")}$(".follow-btn").html(isFollowingAuthor?"Following":"Follow");if(isAdmin||isIbleAuthor)$(".author-action").removeClass("hide");if(loggedIn)this.$("#add-ible-section").show();this.updateSidebar()},updateSidebar:function(){if(this.ibleModel.get("type")!=="Guide"){if(this.session.authenticated()){this.$(".publish-date").html(this.postedDateTemplate(this.ibleModel.toJSON()))}if(this.session.isAdmin()||this.session.isStaff()){if(this.ibleModel.get("featureFlag")===true&&!_.isUndefined(this.ibleModel.get("featuredBy"))){this.$(".featured-by").html(this.featuredByTemplate(this.ibleModel.toJSON()))}}}},updateStats:function(){this.$(".comment-number").html(this.ibleModel.get("comments").toLocaleString());this.$(".favorite-count").html(this.ibleModel.get("favorites").toLocaleString());this.$(".view-count").html(this.ibleModel.get("views").toLocaleString())},fetchUploaderTemplates:function(callback){var loadTemplate=function(templateUrl){return $.ajax({url:templateUrl,success:function(data){$("body").append(data)}})};$.when(loadTemplate("/static/drag_editor/html/js_uploaderTemplates.html"),loadTemplate("/static/drag_editor/html/uploader_prod.html")).done(callback)},fetchUploaderScripts:function(callback){var applyRemotePrefix=function(staticPath){return Ibles.pageContext.remoteRoot+"static/drag_editor/"+staticPath};var uploaderCss=_.map(["dependencies/uploader_depends/jquery-ui-1.10.4.custom/css/ui-lightness/jquery-ui-1.10.4.custom.min.css"],applyRemotePrefix);var uploaderScripts=_.map(["dependencies/uploader_depends/jquery-ui-1.10.4.custom/js/jquery-ui-1.10.4.custom.min.js","js/editor_locale_en_US.js"],applyRemotePrefix).concat(Ibles.pageContext.remoteRoot+window.UPLOAD_SCRIPT.substr(1));head.load(uploaderCss);head.load(uploaderScripts,callback)},scrollToCommentAndToggleImadeIt:function(){Ibles.authFlow.checkLoginThen(function(){var commentBoxContainer=$("#topLevelCommentField"),commentIMadeItButton=commentBoxContainer.find(".comment-imadeit-toggle"),topSpacing=10;$(window).scrollTop(commentBoxContainer.offset().top-$("#ible-header").outerHeight()-topSpacing);if(!commentIMadeItButton.hasClass("active")){commentIMadeItButton.click()}})},setUpCategoryTracking:function(){var categoryCounts={},channelCounts={},category=Ibles.pageContext.ibleData.category,channel=Ibles.pageContext.ibleData.channel;if(_.isUndefined($.cookie("categoryTimer"))){var expiry=moment().add(30,"m"),path=Ibles.reverseUrls.ibleUrl(Ibles.pageContext.ibleData.urlString).replace(/\?lang=\w+$/,"");$.cookie("categoryTimer",Ibles.pageContext.ibleData.id,{path:path,expires:expiry.toDate()});try{if(!_.isUndefined(localStorage["ibleCategories"])){categoryCounts=JSON.parse(localStorage["ibleCategories"])}if(_.isUndefined(categoryCounts[category])){categoryCounts[category]=1}else{categoryCounts[category]=categoryCounts[category]+1}localStorage["ibleCategories"]=JSON.stringify(categoryCounts);if(!_.isUndefined(channel)){if(!_.isUndefined(localStorage["ibleChannels"])){channelCounts=JSON.parse(localStorage["ibleChannels"])}if(_.isUndefined(channelCounts[channel])){channelCounts[channel]=1}else{channelCounts[channel]=channelCounts[channel]+1}localStorage["ibleChannels"]=JSON.stringify(channelCounts)}}catch(e){try{localStorage.clear()}catch(clearError){}}}},setupGtmDataLayer:function(){if(window.dataLayer){window.dataLayer.push({category:Ibles.pageContext.ibleData.category,channel:Ibles.pageContext.ibleData.channel})}},printIt:function(e){e.preventDefault();head.load(Ibles.staticUrl("css/printIt.css"));head.load(Ibles.assets.printItVia3Dhubs(),function(){var currentTarget=$(e.target),filename=currentTarget.attr("data-filename"),fileUrl=currentTarget.attr("data-fileurl"),modal=new Ibles.views.PrintItView({model:new Ibles.models.PrintItModel({filename:filename,fileUrl:Ibles.getLocation(fileUrl).pathname})});$("body").append(modal.render())})}});Ibles.views.StickyHeader=Backbone.View.extend({events:{"click .sticky-header-toggle":"toggleHeader"},initialize:function(){this.makeHeaderSticky();this.setupScrollAdjust()},toggleHeader:function(e){var $header=this.$el,$headerInner=this.$(".sticky-header-inner"),$headerToggle=this.$(".sticky-header-inner"),headerState=$.cookie("stickyHeaderCollapsed")==1?"collapsed":"expanded",visible=$headerInner.is(":visible");
e.preventDefault();document.cookie=visible?"stickyHeaderCollapsed=1; path=/":"stickyHeaderCollapsed=0; path=/";if(visible){$headerInner.slideUp("fast",function(){$header.removeClass("expanded").addClass("collapsed")})}else{$headerInner.slideDown("fast",function(){$header.removeClass("collapsed").addClass("expanded")})}},setupScrollAdjust:function(){var self=this;document.body.addEventListener("keydown",function(event){self.scrollAdjustCallback(event)},false)},scrollAdjustCallback:function(event){var $header=this.$el;if((event.keyCode==32||event.keyCode==34)&&!event.shiftKey){if(document.activeElement.tagName=="BODY"){event.preventDefault();$("html, body").filter(":not(:animated)").animate({scrollTop:$(window).scrollTop()+$(window).height()-($header.hasClass("expanded")?$header.parent().height():0)},"fast")}else if(event.keyCode==34){event.preventDefault()}}},makeHeaderSticky:function(){var self=this;$(window).bind("scroll",function(){self.pinOrUnpinHeader()})},pinOrUnpinHeader:function(){var $header=this.$el,$headerInner=this.$(".sticky-header-inner"),scrollTop=$(window).scrollTop(),headerOffsetTop=$header.parent().offset().top,headerOffsetBottom=headerOffsetTop+$header.height(),headerState=$.cookie("stickyHeaderCollapsed")==1?"collapsed":"expanded",headerCollapsed=($header.hasClass("collapsed")||headerState=="collapsed")&&!$header.hasClass("expanded"),headerPinOffset=headerCollapsed?headerOffsetBottom:headerOffsetTop;if(scrollTop>headerPinOffset){this.pinHeader(headerState);if(headerCollapsed)$headerInner.hide()}else{this.unpinHeader(headerState);if(headerCollapsed)$headerInner.show()}},pinHeader:function(headerState){var $header=this.$el,$headerToggle=this.$(".sticky-header-toggle");if(!this.alreadyPinned){this.alreadyPinned=true;$header.parent().height($header.outerHeight());$header.addClass("fixed "+headerState);$headerToggle.show()}},unpinHeader:function(headerState){var header=this.$el,headerToggle=this.$(".sticky-header-toggle");header.removeClass("fixed "+headerState);headerToggle.hide();this.alreadyPinned=false}});Ibles.views.StickyAdslot=Backbone.View.extend({initialize:function(opts){var self=this;this.updateStickyAdTop=true;this.stickyAdTop=this.$el.offset().top;$(window).bind("scroll",function(){self.pinOrUnpinSidebarAd()})},pinOrUnpinSidebarAd:function(){var $win=$(window),$wrapper=$("#instructable-container"),$mainContent=$("#instructable-content"),$sidebar=$("#instructable-sidebar"),$ibleHeader=$("#ible-header"),$stickyAd=$("#ible-stickyad"),padding=22,stickyAdHeight=$stickyAd.height();scrollTop=$win.scrollTop(),sidebarHeight=$sidebar.height(),sidebarBottomOffset=sidebarHeight+$sidebar.offset().top,mainContentHeight=$mainContent.height(),mainContentBottomOffset=mainContentHeight+$mainContent.offset().top,topAdjust=$ibleHeader.outerHeight()+padding;if(this.updateStickyAdTop)this.stickyAdTop=$stickyAd.offset().top;$stickyAd.parent().height(stickyAdHeight);if(sidebarHeight<mainContentHeight){if(scrollTop+stickyAdHeight>mainContentBottomOffset-topAdjust){$stickyAd.css({top:"auto",position:"absolute",bottom:0,left:"auto"});this.updateStickyAdTop=false}else if(scrollTop>this.stickyAdTop-topAdjust){if($win.width()<$wrapper.width()){$stickyAd.css({top:topAdjust+"px",bottom:"auto",position:"fixed",left:$sidebar.offset().left-$win.scrollLeft()})}else{$stickyAd.css({top:topAdjust+"px",bottom:"auto",position:"fixed",left:"auto"})}this.updateStickyAdTop=false}else{$stickyAd.css({top:"auto",bottom:"auto",left:"auto",position:"relative"});this.updateStickyAdTop=true}}}});Ibles.views.VotingDropdownMenu=Backbone.View.extend({events:{"click #vote-dropdown-toggle":"toggleVoteDropdown","click .vote-toggle-btn":"toggleVote"},model:null,votableContestCollection:null,initialize:function(opts){var votableContest=this.model.get("votableContests");this.template=_.template(Ibles.JST["vote-menu"]);this.votableContestCollection=new Backbone.Collection([],{model:Ibles.models.VotableContestModel});_.each(votableContest,function(contest){contest.ibleId=this.model.get("id");contest.thumbUrl=contest.thumbUrl.replace("THUMB","SQUARE2");contest.url=Ibles.reverseUrls.contestDetailUrl(contest.urlString);var model=new Ibles.models.VotableContestModel(contest);this.votableContestCollection.add(model);this.listenTo(model,"change:votedFor",this.updateVote)},this);this.render()},updateVote:function(model){var $contestBtn=this.$("li[data-contestid='"+model.get("id")+"']").find(".btn");if(model.get("votedFor")){$contestBtn.addClass("active")}else{$contestBtn.removeClass("active")}},toggleVoteDropdown:function(e){e.preventDefault();if(this.$("#vote-dropdown").hasClass("open")){this.hideVoteDropdown()}else{this.showVoteDropdown()}},hideVoteDropdown:function(){this.$el.removeClass("open");$("html").off("click.vote-dropdown")},showVoteDropdown:function(){var self=this;this.$el.addClass("open");$("html").on("click.vote-dropdown",function(e){var target=$(e.target);if(target.closest("#vote-dropdown").length==0){self.hideVoteDropdown()}})},toggleVote:function(e){var self=this;e.preventDefault();Ibles.authFlow.checkLoginThen(function(){var $btn=$(e.currentTarget),$btnLabel=$btn.find(".vote-text"),contestId=$btn.closest("li").data("contestid"),contestModel=self.votableContestCollection.get(contestId);if(!$btn.hasClass("loading")){$btn.addClass("loading");$btnLabel.html($btn.data("loadingtxt"));contestModel.vote(function(){$btn.removeClass("loading");$btnLabel.html($btn.data("votetxt"))})}})},render:function(){this.$el.append(this.template({contests:this.votableContestCollection.toJSON()}));return this}});Ibles.views.PDFDownloadView=Backbone.View.extend({events:{"click #custom-pdf-download-btn":"submitCustomPdfOptions","click #includeImages":"toggleImageSizeOptions"},initialize:function(opts){if(Ibles.session.isPro()||Ibles.session.isOld()||Ibles.session.isAdmin()){this.$(".pdf-download-available").show()}else{this.$(".pdf-download-unavailable").show()}},toggleImageSizeOptions:function(){this.$(".image-sizes").toggle()},submitCustomPdfOptions:function(){var $form=this.$(".pdf-options-form");_.each(this.$(".pdf-options-form .checkbox input"),function(checkbox){var $checkbox=$(checkbox);if(!$checkbox.attr("checked")){$form.append($("<input/>",{type:"hidden",name:$checkbox.attr("name"),value:"off"}))}});_.each(this.$('input[name="includeStepsIds"]'),function(stepInput){var $stepInput=$(stepInput);if(!$stepInput.attr("checked")){$form.append($("<input/>",{type:"hidden",name:"excludeStepsIds",value:$stepInput.attr("value")}))}});$form.submit()}});Ibles.views.MobileInstructableView=Ibles.views.InstructableView.extend({events:{"click .favorite-btn":"attemptFave","click .follow-btn":"attemptFollow","click .google-share-button":"shareOnGPlus","click .facebook-share-button":"shareOnFacebook","click .vote-btn":"toggleVoteDrawer","click .flag-btn":"attemptFlag","click .social-controls-vote":"scrollAndVote","click .ible-social-menu .vote-btn":"scrollAndVote","click #full-instructable-button":"setPagePosCookie","click .show-more-images":"showMoreImages","click .test-feature":"showNotImplemented"},initialize:function(opts){this.opts=opts;this.session=Ibles.session;this.setupCommonSubviewsAndModels();this.setupFlagger();this.setUpCategoryTracking();this.setupGtmDataLayer();this.fetchUserInstructableData();this.render();this.scrollToAllStepsStart();Ibles.lazyLoadImages($(".lazy-img"))},setupUserSpecificViewsAndModels:function(){this.setupVoting()},scrollToAllStepsStart:function(){if(!_.isUndefined($.cookie("pagePos"))&&!_.isUndefined($.cookie("ibleId"))){if(this.allSteps&&$.cookie("ibleId")===this.ibleModel.get("id")){$(document).scrollTop($.cookie("pagePos"))}$.removeCookie("ibleId",{path:"/"});$.removeCookie("pagePos",{path:"/"})}},setPagePosCookie:function(e){e.preventDefault();e.stopPropagation();$.cookie("pagePos",$(document).scrollTop(),{path:"/"});$.cookie("ibleId",this.ibleModel.get("id"),{path:"/"});var currentAllstepsClickCount=parseInt($.cookie("viewAllStepsClickCount")||0);$.cookie("viewAllStepsClickCount",currentAllstepsClickCount+1,{path:"/"});window.location=$(e.currentTarget).attr("href")},setupComments:function(){var self=this,opts=this.opts;if(!opts||!opts.disableComments){sessionReady(function(){self.commentsManager=new Ibles.views.MobileCommentManager})}},setupVoting:function(){var votableContests=this.ibleModel.get("votableContests");if(!_.isEmpty(votableContests)){this.$(".vote-toggle").addClass("vote-active");_.each(votableContests,function(contest){contest.ibleId=this.ibleModel.get("id");var contestView=new Ibles.views.MobileVotableContestView({model:new Ibles.models.VotableContestModel(contest)});$("#vote-drawer").prepend(contestView.render())},this)}},updateSidebar:function(){},setupFlagger:function(){var flagger,data=_.pick(Ibles.pageContext.ibleData,"id","featured","typeChar","status");data.destUrl=window.location.pathname;data.type="INSTRUCTABLE";flagger=new Ibles.models.FlaggerModel(data);new Ibles.views.IbleFlaggerView({model:flagger,el:"#flag-drawer"})},attemptFlag:function(e){e.preventDefault();if(Ibles.session.authenticated()){if($("#flag-drawer").is(":visible")){$("#flag-drawer").slideUp()}else{$(".header-drawer").hide();$("#flag-drawer").slideDown()}}},toggleVoteDrawer:function(e){e.preventDefault();if($("#vote-drawer").is(":visible")){$("#vote-drawer").slideUp()}else{$(".header-drawer").hide();$("#vote-drawer").slideDown()}},showVoteDrawer:function(e){e.preventDefault();if(!$("#vote-drawer").is(":visible")){$(".header-drawer").hide();$("#vote-drawer").slideDown()}},scrollAndVote:function(e){e.preventDefault();var that=this;$("html, body").animate({scrollTop:$(".vote-btn.mobile-ible-header-controls-btn").offset().top},1e3,_.debounce(function(){that.showVoteDrawer(e)},50))},showMoreImages:function(e){e.preventDefault();var trigger=$(e.currentTarget);trigger.hide();trigger.closest(".mobile-step-files").find(".mobile-file-photo").removeClass("hide");$("html, body").animate({scrollTop:$(window).scrollTop()+100})},showNotImplemented:function(e){e.preventDefault();new Ibles.views.ComingSoonView},updateStats:function(){this.$(".comment-number").html(Ibles.formatNumber(this.ibleModel.get("comments")));this.$(".favorite-count").html(Ibles.formatNumber(this.ibleModel.get("favorites")));this.$(".view-count").html(Ibles.formatNumber(this.ibleModel.get("views")))}});Ibles.views.MobileVotableContestView=Backbone.View.extend({className:"votable-contest",events:{"click .vote-toggle-link":"voteAction"},initialize:function(){this.template=_.template(Ibles.JST["mobile-votable-contest"]);this.listenTo(this.model,"change:votedFor",this.updateVote)},voteAction:function(e){e.preventDefault();if(!this.$el.hasClass("loading")&&Ibles.session.authenticated()){this.$el.addClass("loading");var that=this;this.model.vote(function(){that.$el.removeClass("loading")})}},updateVote:function(){if(this.model.get("votedFor")){this.$(".vote-toggle-link").addClass("active")}else{this.$(".vote-toggle-link").removeClass("active")}},render:function(){this.$el.html(this.template(this.model.toJSON()));return this.$el}});Ibles.views.ComingSoonView=Backbone.View.extend({id:"coming-soon-modal",events:{"click .ok.btn":"closeModal"},initialize:function(){this.template=_.template(Ibles.JST["coming-soon-modal"]);this.render()},closeModal:function(){this.$el.find(".coming-soon-modal").modal("hide")},render:function(){var that=this;this.$el.append(this.template(this.data));$("body").append(this.$el);this.$el.find(".coming-soon-modal").modal("show").on("hidden.bs.modal",function(){that.remove.call(that)})},remove:function(){this.$el.remove()}});Ibles.package("Ibles.views");Ibles.views.IbleShareMenuView=Backbone.View.extend({el:".share-menu",template:_.template(Ibles.JST["share-menu"]),initialize:function(){this.render()},render:function(){var JSON=this.model.toJSON();JSON.fullUrl=encodeURIComponent(JSON.fullUrl);JSON.title=encodeURIComponent(JSON.title);this.$el.html(this.template(JSON));return this.$el}});Ibles.package("Ibles.views");Ibles.views.SocialShareOverlayView=Backbone.View.extend({template:_.template(Ibles.JST["social-share-overlay"]),model:null,overlayEl:null,linkShareOverlayEl:null,events:{"mouseenter .photoset-image":"showShareOverlay","mouseenter .social-share-overlay, .link-share-overlay":"keepShareOverlayVisible","mouseleave .photoset-image, .social-share-overlay, .link-share-overlay":"hideShareOverlay","mouseenter .link-share-btn":"showLinkShareOverlay","mouseenter .link-share-overlay":"keepLinkShareOverlayVisible","mouseleave .link-share-btn, .link-share-overlay":"hideLinkShareOverlay","click .facebook-share-btn":"shareThroughFacebook","click .twitter-share-btn":"shareThroughTwitter","click .pinterest-share-btn":"shareThroughPinterest","click .email-share-btn":"shareThroughEmail"},initialize:function(opts){opts=opts||{};this.additionalSharedContext={};this.overlayEl=$(this.template({sharedUrl:this.model.get("fullUrl")}));this.linkShareOverlayEl=this.overlayEl.find(".link-share-overlay").css({left:this.overlayEl.width()});this.$el.append(this.overlayEl);this.setupCopyBehavior()},setupCopyBehavior:function(){ZeroClipboard.config({cacheBust:false,swfPath:Ibles.staticUrl("js/ZeroClipboard.swf")});var clipboard=new ZeroClipboard(this.linkShareOverlayEl.find("button").get(0)),self=this;clipboard.on("ready",function(readyEvent){clipboard.on("aftercopy",function(copyEvent){var copyBtn=self.linkShareOverlayEl.find("button");copyBtn.text("Copied!");_.delay(function(){copyBtn.text("Copy")},1e3)})})},setAdditionalSharedContextFromEvent:function(e){var $target=$(e.currentTarget);if($target.hasClass("photoset-image")){_.extend(this.additionalSharedContext,{image:$target.find("img").data("medium-image")})}},showShareOverlay:function(e){clearTimeout(this.hideTimeout);this.setAdditionalSharedContextFromEvent(e);this.overlayEl.addClass("hover");this.showTimeout=setTimeout(_.bind(function(){var offset=$(e.currentTarget).offset();this.overlayEl.css({top:offset.top+"px",left:offset.left-this.overlayEl.width()+"px"}).show()},this),100)},keepShareOverlayVisible:function(e){this.overlayEl.addClass("hover")},hideShareOverlay:function(e){clearTimeout(this.showTimeout);this.overlayEl.removeClass("hover");this.hideTimeout=setTimeout(_.bind(function(){if(!this.overlayEl.hasClass("hover"))this.overlayEl.hide()},this),1e3)},showLinkShareOverlay:function(e){var linkBtn=$(e.currentTarget);clearTimeout(this.hideLinkShareTimeout);this.linkShareOverlayEl.addClass("hover");this.showLinkShareTimeout=setTimeout(_.bind(function(){this.linkShareOverlayEl.css({left:this.overlayEl.width(),top:linkBtn.position().top+"px"}).show();this.selectLinkShareOverlayInput()},this),100)},keepLinkShareOverlayVisible:function(e){this.linkShareOverlayEl.addClass("hover")},hideLinkShareOverlay:function(e){clearTimeout(this.showLinkShareTimeout);this.linkShareOverlayEl.removeClass("hover");this.hideLinkShareTimeout=setTimeout(_.bind(function(){if(!this.linkShareOverlayEl.hasClass("hover"))this.linkShareOverlayEl.hide()},this),1e3)},getSharedImage:function(){return this.additionalSharedContext.image||this.model.get("mediumUrl")},selectLinkShareOverlayInput:function(){this.linkShareOverlayEl.find("input").focus().select()},shareThroughFacebook:function(e){e.preventDefault();if(!_.isUndefined(FB)){FB.ui({method:"feed",link:this.model.get("fullUrl"),picture:this.getSharedImage(),name:this.model.get("title"),caption:"via www.instructables.com"})}},shareThroughTwitter:function(e){e.preventDefault();window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(this.model.get("title"))+"&url="+encodeURIComponent(this.model.get("fullUrl")),"tweet","height=300,width=550,resizable=1")},shareThroughPinterest:function(e){e.preventDefault();window.open("http://pinterest.com/pin/create/button/?url="+encodeURIComponent(this.model.get("fullUrl"))+"&media="+encodeURIComponent(this.getSharedImage())+"&description="+encodeURIComponent(this.model.get("title")),"pin it","scrollbars=yes,width=800,height=400")},shareThroughEmail:function(e){e.preventDefault();window.location.href="mailto:?subject="+encodeURIComponent(this.model.get("title"))+"&body="+encodeURIComponent(this.model.get("fullUrl"))}});(function(window,undefined){"use strict";var _window=window,_document=_window.document,_navigator=_window.navigator,_setTimeout=_window.setTimeout,_clearTimeout=_window.clearTimeout,_setInterval=_window.setInterval,_clearInterval=_window.clearInterval,_getComputedStyle=_window.getComputedStyle,_encodeURIComponent=_window.encodeURIComponent,_ActiveXObject=_window.ActiveXObject,_Error=_window.Error,_parseInt=_window.Number.parseInt||_window.parseInt,_parseFloat=_window.Number.parseFloat||_window.parseFloat,_isNaN=_window.Number.isNaN||_window.isNaN,_now=_window.Date.now,_keys=_window.Object.keys,_defineProperty=_window.Object.defineProperty,_hasOwn=_window.Object.prototype.hasOwnProperty,_slice=_window.Array.prototype.slice,_unwrap=function(){var unwrapper=function(el){return el};if(typeof _window.wrap==="function"&&typeof _window.unwrap==="function"){try{var div=_document.createElement("div");var unwrappedDiv=_window.unwrap(div);if(div.nodeType===1&&unwrappedDiv&&unwrappedDiv.nodeType===1){unwrapper=_window.unwrap}}catch(e){}}return unwrapper}();var _args=function(argumentsObj){return _slice.call(argumentsObj,0)};var _extend=function(){var i,len,arg,prop,src,copy,args=_args(arguments),target=args[0]||{};for(i=1,len=args.length;i<len;i++){if((arg=args[i])!=null){for(prop in arg){if(_hasOwn.call(arg,prop)){src=target[prop];copy=arg[prop];if(target!==copy&&copy!==undefined){target[prop]=copy}}}}}return target};var _deepCopy=function(source){var copy,i,len,prop;if(typeof source!=="object"||source==null||typeof source.nodeType==="number"){copy=source}else if(typeof source.length==="number"){copy=[];for(i=0,len=source.length;i<len;i++){if(_hasOwn.call(source,i)){copy[i]=_deepCopy(source[i])}}}else{copy={};for(prop in source){if(_hasOwn.call(source,prop)){copy[prop]=_deepCopy(source[prop])}}}return copy};var _pick=function(obj,keys){var newObj={};for(var i=0,len=keys.length;i<len;i++){if(keys[i]in obj){newObj[keys[i]]=obj[keys[i]]}}return newObj};var _omit=function(obj,keys){var newObj={};for(var prop in obj){if(keys.indexOf(prop)===-1){newObj[prop]=obj[prop]}}return newObj};var _deleteOwnProperties=function(obj){if(obj){for(var prop in obj){if(_hasOwn.call(obj,prop)){delete obj[prop]}}}return obj};var _containedBy=function(el,ancestorEl){if(el&&el.nodeType===1&&el.ownerDocument&&ancestorEl&&(ancestorEl.nodeType===1&&ancestorEl.ownerDocument&&ancestorEl.ownerDocument===el.ownerDocument||ancestorEl.nodeType===9&&!ancestorEl.ownerDocument&&ancestorEl===el.ownerDocument)){do{if(el===ancestorEl){return true}el=el.parentNode}while(el)}return false};var _getDirPathOfUrl=function(url){var dir;if(typeof url==="string"&&url){dir=url.split("#")[0].split("?")[0];dir=url.slice(0,url.lastIndexOf("/")+1)}return dir};var _getCurrentScriptUrlFromErrorStack=function(stack){var url,matches;if(typeof stack==="string"&&stack){matches=stack.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/);if(matches&&matches[1]){url=matches[1]}else{matches=stack.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/);if(matches&&matches[1]){url=matches[1]}}}return url};var _getCurrentScriptUrlFromError=function(){var url,err;try{throw new _Error}catch(e){err=e}if(err){url=err.sourceURL||err.fileName||_getCurrentScriptUrlFromErrorStack(err.stack)}return url};var _getCurrentScriptUrl=function(){var jsPath,scripts,i;if(_document.currentScript&&(jsPath=_document.currentScript.src)){return jsPath}scripts=_document.getElementsByTagName("script");if(scripts.length===1){return scripts[0].src||undefined}if("readyState"in scripts[0]){for(i=scripts.length;i--;){if(scripts[i].readyState==="interactive"&&(jsPath=scripts[i].src)){return jsPath}}}if(_document.readyState==="loading"&&(jsPath=scripts[scripts.length-1].src)){return jsPath}if(jsPath=_getCurrentScriptUrlFromError()){return jsPath}return undefined};var _getUnanimousScriptParentDir=function(){var i,jsDir,jsPath,scripts=_document.getElementsByTagName("script");for(i=scripts.length;i--;){if(!(jsPath=scripts[i].src)){jsDir=null;break}jsPath=_getDirPathOfUrl(jsPath);if(jsDir==null){jsDir=jsPath}else if(jsDir!==jsPath){jsDir=null;break}}return jsDir||undefined};var _getDefaultSwfPath=function(){var jsDir=_getDirPathOfUrl(_getCurrentScriptUrl())||_getUnanimousScriptParentDir()||"";return jsDir+"ZeroClipboard.swf"};var _pageIsFramed=function(){return window.opener==null&&(!!window.top&&window!=window.top||!!window.parent&&window!=window.parent)}();var _flashState={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,sandboxed:null,unavailable:null,degraded:null,deactivated:null,overdue:null,ready:null};var _minimumFlashVersion="11.0.0";var _zcSwfVersion;var _handlers={};var _currentElement;var _copyTarget;var _clipData={};var _clipDataFormatMap=null;var _flashCheckTimeout=0;var _swfFallbackCheckInterval=0;var _eventMessages={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed. May also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-sandboxed":"Attempting to run Flash in a sandboxed iframe, which is impossible","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-degraded":"Flash is unable to preserve data fidelity when communicating with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate.\nThis may also mean that the ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity.\nMay also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-overdue":"Flash communication was established but NOT within the acceptable time limit","version-mismatch":"ZeroClipboard JS version number does not match ZeroClipboard SWF version number","clipboard-error":"At least one error was thrown while ZeroClipboard was attempting to inject your data into the clipboard","config-mismatch":"ZeroClipboard configuration does not match Flash's reality","swf-not-found":"The ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity"}};var _errorsThatOnlyOccurAfterFlashLoads=["flash-unavailable","flash-degraded","flash-overdue","version-mismatch","config-mismatch","clipboard-error"];var _flashStateErrorNames=["flash-disabled","flash-outdated","flash-sandboxed","flash-unavailable","flash-degraded","flash-deactivated","flash-overdue"];var _flashStateErrorNameMatchingRegex=new RegExp("^flash-("+_flashStateErrorNames.map(function(errorName){return errorName.replace(/^flash-/,"")}).join("|")+")$");var _flashStateEnabledErrorNameMatchingRegex=new RegExp("^flash-("+_flashStateErrorNames.slice(1).map(function(errorName){return errorName.replace(/^flash-/,"")}).join("|")+")$");var _globalConfig={swfPath:_getDefaultSwfPath(),trustedDomains:window.location.host?[window.location.host]:[],cacheBust:true,forceEnhancedClipboard:false,flashLoadTimeout:3e4,autoActivate:true,bubbleEvents:true,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:false,title:null,zIndex:999999999};var _config=function(options){if(typeof options==="object"&&options!==null){for(var prop in options){if(_hasOwn.call(options,prop)){if(/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(prop)){_globalConfig[prop]=options[prop]}else if(_flashState.bridge==null){if(prop==="containerId"||prop==="swfObjectId"){if(_isValidHtml4Id(options[prop])){_globalConfig[prop]=options[prop]}else{throw new Error("The specified `"+prop+"` value is not valid as an HTML4 Element ID")}}else{_globalConfig[prop]=options[prop]}}}}}if(typeof options==="string"&&options){if(_hasOwn.call(_globalConfig,options)){return _globalConfig[options]}return}return _deepCopy(_globalConfig)};var _state=function(){_detectSandbox();return{browser:_pick(_navigator,["userAgent","platform","appName"]),flash:_omit(_flashState,["bridge"]),zeroclipboard:{version:ZeroClipboard.version,config:ZeroClipboard.config()}}};var _isFlashUnusable=function(){return!!(_flashState.disabled||_flashState.outdated||_flashState.sandboxed||_flashState.unavailable||_flashState.degraded||_flashState.deactivated)};var _on=function(eventType,listener){var i,len,events,added={};if(typeof eventType==="string"&&eventType){events=eventType.toLowerCase().split(/\s+/)}else if(typeof eventType==="object"&&eventType&&typeof listener==="undefined"){for(i in eventType){if(_hasOwn.call(eventType,i)&&typeof i==="string"&&i&&typeof eventType[i]==="function"){ZeroClipboard.on(i,eventType[i])}}}if(events&&events.length){for(i=0,len=events.length;i<len;i++){eventType=events[i].replace(/^on/,"");added[eventType]=true;if(!_handlers[eventType]){_handlers[eventType]=[]}_handlers[eventType].push(listener)}if(added.ready&&_flashState.ready){ZeroClipboard.emit({type:"ready"})}if(added.error){for(i=0,len=_flashStateErrorNames.length;i<len;i++){if(_flashState[_flashStateErrorNames[i].replace(/^flash-/,"")]===true){ZeroClipboard.emit({type:"error",name:_flashStateErrorNames[i]});break}}if(_zcSwfVersion!==undefined&&ZeroClipboard.version!==_zcSwfVersion){ZeroClipboard.emit({type:"error",name:"version-mismatch",jsVersion:ZeroClipboard.version,swfVersion:_zcSwfVersion})}}}return ZeroClipboard};var _off=function(eventType,listener){var i,len,foundIndex,events,perEventHandlers;if(arguments.length===0){events=_keys(_handlers)}else if(typeof eventType==="string"&&eventType){events=eventType.split(/\s+/)}else if(typeof eventType==="object"&&eventType&&typeof listener==="undefined"){for(i in eventType){if(_hasOwn.call(eventType,i)&&typeof i==="string"&&i&&typeof eventType[i]==="function"){ZeroClipboard.off(i,eventType[i])}}}if(events&&events.length){for(i=0,len=events.length;i<len;i++){eventType=events[i].toLowerCase().replace(/^on/,"");perEventHandlers=_handlers[eventType];if(perEventHandlers&&perEventHandlers.length){if(listener){foundIndex=perEventHandlers.indexOf(listener);while(foundIndex!==-1){perEventHandlers.splice(foundIndex,1);foundIndex=perEventHandlers.indexOf(listener,foundIndex)}}else{perEventHandlers.length=0}}}}return ZeroClipboard};var _listeners=function(eventType){var copy;if(typeof eventType==="string"&&eventType){copy=_deepCopy(_handlers[eventType])||null}else{copy=_deepCopy(_handlers)}return copy};var _emit=function(event){var eventCopy,returnVal,tmp;event=_createEvent(event);if(!event){return}if(_preprocessEvent(event)){return}if(event.type==="ready"&&_flashState.overdue===true){return ZeroClipboard.emit({type:"error",name:"flash-overdue"})}eventCopy=_extend({},event);_dispatchCallbacks.call(this,eventCopy);if(event.type==="copy"){tmp=_mapClipDataToFlash(_clipData);returnVal=tmp.data;_clipDataFormatMap=tmp.formatMap}return returnVal};var _create=function(){var previousState=_flashState.sandboxed;_detectSandbox();if(typeof _flashState.ready!=="boolean"){_flashState.ready=false}if(_flashState.sandboxed!==previousState&&_flashState.sandboxed===true){_flashState.ready=false;ZeroClipboard.emit({type:"error",name:"flash-sandboxed"})}else if(!ZeroClipboard.isFlashUnusable()&&_flashState.bridge===null){var maxWait=_globalConfig.flashLoadTimeout;if(typeof maxWait==="number"&&maxWait>=0){_flashCheckTimeout=_setTimeout(function(){if(typeof _flashState.deactivated!=="boolean"){_flashState.deactivated=true}if(_flashState.deactivated===true){ZeroClipboard.emit({type:"error",name:"flash-deactivated"})}},maxWait)}_flashState.overdue=false;_embedSwf()}};var _destroy=function(){ZeroClipboard.clearData();ZeroClipboard.blur();ZeroClipboard.emit("destroy");_unembedSwf();ZeroClipboard.off()};var _setData=function(format,data){var dataObj;if(typeof format==="object"&&format&&typeof data==="undefined"){dataObj=format;ZeroClipboard.clearData()}else if(typeof format==="string"&&format){dataObj={};dataObj[format]=data}else{return}for(var dataFormat in dataObj){if(typeof dataFormat==="string"&&dataFormat&&_hasOwn.call(dataObj,dataFormat)&&typeof dataObj[dataFormat]==="string"&&dataObj[dataFormat]){_clipData[dataFormat]=dataObj[dataFormat]}}};var _clearData=function(format){if(typeof format==="undefined"){_deleteOwnProperties(_clipData);_clipDataFormatMap=null}else if(typeof format==="string"&&_hasOwn.call(_clipData,format)){delete _clipData[format]}};var _getData=function(format){if(typeof format==="undefined"){return _deepCopy(_clipData)}else if(typeof format==="string"&&_hasOwn.call(_clipData,format)){return _clipData[format]}};var _focus=function(element){if(!(element&&element.nodeType===1)){return}if(_currentElement){_removeClass(_currentElement,_globalConfig.activeClass);if(_currentElement!==element){_removeClass(_currentElement,_globalConfig.hoverClass)}}_currentElement=element;_addClass(element,_globalConfig.hoverClass);var newTitle=element.getAttribute("title")||_globalConfig.title;if(typeof newTitle==="string"&&newTitle){var htmlBridge=_getHtmlBridge(_flashState.bridge);if(htmlBridge){htmlBridge.setAttribute("title",newTitle)}}var useHandCursor=_globalConfig.forceHandCursor===true||_getStyle(element,"cursor")==="pointer";_setHandCursor(useHandCursor);_reposition()};var _blur=function(){var htmlBridge=_getHtmlBridge(_flashState.bridge);if(htmlBridge){htmlBridge.removeAttribute("title");htmlBridge.style.left="0px";htmlBridge.style.top="-9999px";htmlBridge.style.width="1px";htmlBridge.style.height="1px"}if(_currentElement){_removeClass(_currentElement,_globalConfig.hoverClass);_removeClass(_currentElement,_globalConfig.activeClass);_currentElement=null}};var _activeElement=function(){return _currentElement||null};var _isValidHtml4Id=function(id){return typeof id==="string"&&id&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(id)};var _createEvent=function(event){var eventType;if(typeof event==="string"&&event){eventType=event;event={}}else if(typeof event==="object"&&event&&typeof event.type==="string"&&event.type){eventType=event.type}if(!eventType){return}eventType=eventType.toLowerCase();if(!event.target&&(/^(copy|aftercopy|_click)$/.test(eventType)||eventType==="error"&&event.name==="clipboard-error")){event.target=_copyTarget}_extend(event,{type:eventType,target:event.target||_currentElement||null,relatedTarget:event.relatedTarget||null,currentTarget:_flashState&&_flashState.bridge||null,timeStamp:event.timeStamp||_now()||null});var msg=_eventMessages[event.type];if(event.type==="error"&&event.name&&msg){msg=msg[event.name]}if(msg){event.message=msg}if(event.type==="ready"){_extend(event,{target:null,version:_flashState.version})}if(event.type==="error"){if(_flashStateErrorNameMatchingRegex.test(event.name)){_extend(event,{target:null,minimumVersion:_minimumFlashVersion})}if(_flashStateEnabledErrorNameMatchingRegex.test(event.name)){_extend(event,{version:_flashState.version})}}if(event.type==="copy"){event.clipboardData={setData:ZeroClipboard.setData,clearData:ZeroClipboard.clearData}}if(event.type==="aftercopy"){event=_mapClipResultsFromFlash(event,_clipDataFormatMap)}if(event.target&&!event.relatedTarget){event.relatedTarget=_getRelatedTarget(event.target)}return _addMouseData(event)};var _getRelatedTarget=function(targetEl){var relatedTargetId=targetEl&&targetEl.getAttribute&&targetEl.getAttribute("data-clipboard-target");return relatedTargetId?_document.getElementById(relatedTargetId):null};var _addMouseData=function(event){if(event&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(event.type)){var srcElement=event.target;var fromElement=event.type==="_mouseover"&&event.relatedTarget?event.relatedTarget:undefined;
var toElement=event.type==="_mouseout"&&event.relatedTarget?event.relatedTarget:undefined;var pos=_getElementPosition(srcElement);var screenLeft=_window.screenLeft||_window.screenX||0;var screenTop=_window.screenTop||_window.screenY||0;var scrollLeft=_document.body.scrollLeft+_document.documentElement.scrollLeft;var scrollTop=_document.body.scrollTop+_document.documentElement.scrollTop;var pageX=pos.left+(typeof event._stageX==="number"?event._stageX:0);var pageY=pos.top+(typeof event._stageY==="number"?event._stageY:0);var clientX=pageX-scrollLeft;var clientY=pageY-scrollTop;var screenX=screenLeft+clientX;var screenY=screenTop+clientY;var moveX=typeof event.movementX==="number"?event.movementX:0;var moveY=typeof event.movementY==="number"?event.movementY:0;delete event._stageX;delete event._stageY;_extend(event,{srcElement:srcElement,fromElement:fromElement,toElement:toElement,screenX:screenX,screenY:screenY,pageX:pageX,pageY:pageY,clientX:clientX,clientY:clientY,x:clientX,y:clientY,movementX:moveX,movementY:moveY,offsetX:0,offsetY:0,layerX:0,layerY:0})}return event};var _shouldPerformAsync=function(event){var eventType=event&&typeof event.type==="string"&&event.type||"";return!/^(?:(?:before)?copy|destroy)$/.test(eventType)};var _dispatchCallback=function(func,context,args,async){if(async){_setTimeout(function(){func.apply(context,args)},0)}else{func.apply(context,args)}};var _dispatchCallbacks=function(event){if(!(typeof event==="object"&&event&&event.type)){return}var async=_shouldPerformAsync(event);var wildcardTypeHandlers=_handlers["*"]||[];var specificTypeHandlers=_handlers[event.type]||[];var handlers=wildcardTypeHandlers.concat(specificTypeHandlers);if(handlers&&handlers.length){var i,len,func,context,eventCopy,originalContext=this;for(i=0,len=handlers.length;i<len;i++){func=handlers[i];context=originalContext;if(typeof func==="string"&&typeof _window[func]==="function"){func=_window[func]}if(typeof func==="object"&&func&&typeof func.handleEvent==="function"){context=func;func=func.handleEvent}if(typeof func==="function"){eventCopy=_extend({},event);_dispatchCallback(func,context,[eventCopy],async)}}}return this};var _getSandboxStatusFromErrorEvent=function(event){var isSandboxed=null;if(_pageIsFramed===false||event&&event.type==="error"&&event.name&&_errorsThatOnlyOccurAfterFlashLoads.indexOf(event.name)!==-1){isSandboxed=false}return isSandboxed};var _preprocessEvent=function(event){var element=event.target||_currentElement||null;var sourceIsSwf=event._source==="swf";delete event._source;switch(event.type){case"error":var isSandboxed=event.name==="flash-sandboxed"||_getSandboxStatusFromErrorEvent(event);if(typeof isSandboxed==="boolean"){_flashState.sandboxed=isSandboxed}if(_flashStateErrorNames.indexOf(event.name)!==-1){_extend(_flashState,{disabled:event.name==="flash-disabled",outdated:event.name==="flash-outdated",unavailable:event.name==="flash-unavailable",degraded:event.name==="flash-degraded",deactivated:event.name==="flash-deactivated",overdue:event.name==="flash-overdue",ready:false})}else if(event.name==="version-mismatch"){_zcSwfVersion=event.swfVersion;_extend(_flashState,{disabled:false,outdated:false,unavailable:false,degraded:false,deactivated:false,overdue:false,ready:false})}_clearTimeoutsAndPolling();break;case"ready":_zcSwfVersion=event.swfVersion;var wasDeactivated=_flashState.deactivated===true;_extend(_flashState,{disabled:false,outdated:false,sandboxed:false,unavailable:false,degraded:false,deactivated:false,overdue:wasDeactivated,ready:!wasDeactivated});_clearTimeoutsAndPolling();break;case"beforecopy":_copyTarget=element;break;case"copy":var textContent,htmlContent,targetEl=event.relatedTarget;if(!(_clipData["text/html"]||_clipData["text/plain"])&&targetEl&&(htmlContent=targetEl.value||targetEl.outerHTML||targetEl.innerHTML)&&(textContent=targetEl.value||targetEl.textContent||targetEl.innerText)){event.clipboardData.clearData();event.clipboardData.setData("text/plain",textContent);if(htmlContent!==textContent){event.clipboardData.setData("text/html",htmlContent)}}else if(!_clipData["text/plain"]&&event.target&&(textContent=event.target.getAttribute("data-clipboard-text"))){event.clipboardData.clearData();event.clipboardData.setData("text/plain",textContent)}break;case"aftercopy":_queueEmitClipboardErrors(event);ZeroClipboard.clearData();if(element&&element!==_safeActiveElement()&&element.focus){element.focus()}break;case"_mouseover":ZeroClipboard.focus(element);if(_globalConfig.bubbleEvents===true&&sourceIsSwf){if(element&&element!==event.relatedTarget&&!_containedBy(event.relatedTarget,element)){_fireMouseEvent(_extend({},event,{type:"mouseenter",bubbles:false,cancelable:false}))}_fireMouseEvent(_extend({},event,{type:"mouseover"}))}break;case"_mouseout":ZeroClipboard.blur();if(_globalConfig.bubbleEvents===true&&sourceIsSwf){if(element&&element!==event.relatedTarget&&!_containedBy(event.relatedTarget,element)){_fireMouseEvent(_extend({},event,{type:"mouseleave",bubbles:false,cancelable:false}))}_fireMouseEvent(_extend({},event,{type:"mouseout"}))}break;case"_mousedown":_addClass(element,_globalConfig.activeClass);if(_globalConfig.bubbleEvents===true&&sourceIsSwf){_fireMouseEvent(_extend({},event,{type:event.type.slice(1)}))}break;case"_mouseup":_removeClass(element,_globalConfig.activeClass);if(_globalConfig.bubbleEvents===true&&sourceIsSwf){_fireMouseEvent(_extend({},event,{type:event.type.slice(1)}))}break;case"_click":_copyTarget=null;if(_globalConfig.bubbleEvents===true&&sourceIsSwf){_fireMouseEvent(_extend({},event,{type:event.type.slice(1)}))}break;case"_mousemove":if(_globalConfig.bubbleEvents===true&&sourceIsSwf){_fireMouseEvent(_extend({},event,{type:event.type.slice(1)}))}break}if(/^_(?:click|mouse(?:over|out|down|up|move))$/.test(event.type)){return true}};var _queueEmitClipboardErrors=function(aftercopyEvent){if(aftercopyEvent.errors&&aftercopyEvent.errors.length>0){var errorEvent=_deepCopy(aftercopyEvent);_extend(errorEvent,{type:"error",name:"clipboard-error"});delete errorEvent.success;_setTimeout(function(){ZeroClipboard.emit(errorEvent)},0)}};var _fireMouseEvent=function(event){if(!(event&&typeof event.type==="string"&&event)){return}var e,target=event.target||null,doc=target&&target.ownerDocument||_document,defaults={view:doc.defaultView||_window,canBubble:true,cancelable:true,detail:event.type==="click"?1:0,button:typeof event.which==="number"?event.which-1:typeof event.button==="number"?event.button:doc.createEvent?0:1},args=_extend(defaults,event);if(!target){return}if(doc.createEvent&&target.dispatchEvent){args=[args.type,args.canBubble,args.cancelable,args.view,args.detail,args.screenX,args.screenY,args.clientX,args.clientY,args.ctrlKey,args.altKey,args.shiftKey,args.metaKey,args.button,args.relatedTarget];e=doc.createEvent("MouseEvents");if(e.initMouseEvent){e.initMouseEvent.apply(e,args);e._source="js";target.dispatchEvent(e)}}};var _watchForSwfFallbackContent=function(){var maxWait=_globalConfig.flashLoadTimeout;if(typeof maxWait==="number"&&maxWait>=0){var pollWait=Math.min(1e3,maxWait/10);var fallbackContentId=_globalConfig.swfObjectId+"_fallbackContent";_swfFallbackCheckInterval=_setInterval(function(){var el=_document.getElementById(fallbackContentId);if(_isElementVisible(el)){_clearTimeoutsAndPolling();_flashState.deactivated=null;ZeroClipboard.emit({type:"error",name:"swf-not-found"})}},pollWait)}};var _createHtmlBridge=function(){var container=_document.createElement("div");container.id=_globalConfig.containerId;container.className=_globalConfig.containerClass;container.style.position="absolute";container.style.left="0px";container.style.top="-9999px";container.style.width="1px";container.style.height="1px";container.style.zIndex=""+_getSafeZIndex(_globalConfig.zIndex);return container};var _getHtmlBridge=function(flashBridge){var htmlBridge=flashBridge&&flashBridge.parentNode;while(htmlBridge&&htmlBridge.nodeName==="OBJECT"&&htmlBridge.parentNode){htmlBridge=htmlBridge.parentNode}return htmlBridge||null};var _embedSwf=function(){var len,flashBridge=_flashState.bridge,container=_getHtmlBridge(flashBridge);if(!flashBridge){var allowScriptAccess=_determineScriptAccess(_window.location.host,_globalConfig);var allowNetworking=allowScriptAccess==="never"?"none":"all";var flashvars=_vars(_extend({jsVersion:ZeroClipboard.version},_globalConfig));var swfUrl=_globalConfig.swfPath+_cacheBust(_globalConfig.swfPath,_globalConfig);container=_createHtmlBridge();var divToBeReplaced=_document.createElement("div");container.appendChild(divToBeReplaced);_document.body.appendChild(container);var tmpDiv=_document.createElement("div");var usingActiveX=_flashState.pluginType==="activex";tmpDiv.innerHTML='<object id="'+_globalConfig.swfObjectId+'" name="'+_globalConfig.swfObjectId+'" '+'width="100%" height="100%" '+(usingActiveX?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+swfUrl+'"')+">"+(usingActiveX?'<param name="movie" value="'+swfUrl+'"/>':"")+'<param name="allowScriptAccess" value="'+allowScriptAccess+'"/>'+'<param name="allowNetworking" value="'+allowNetworking+'"/>'+'<param name="menu" value="false"/>'+'<param name="wmode" value="transparent"/>'+'<param name="flashvars" value="'+flashvars+'"/>'+'<div id="'+_globalConfig.swfObjectId+'_fallbackContent">&nbsp;</div>'+"</object>";flashBridge=tmpDiv.firstChild;tmpDiv=null;_unwrap(flashBridge).ZeroClipboard=ZeroClipboard;container.replaceChild(flashBridge,divToBeReplaced);_watchForSwfFallbackContent()}if(!flashBridge){flashBridge=_document[_globalConfig.swfObjectId];if(flashBridge&&(len=flashBridge.length)){flashBridge=flashBridge[len-1]}if(!flashBridge&&container){flashBridge=container.firstChild}}_flashState.bridge=flashBridge||null;return flashBridge};var _unembedSwf=function(){var flashBridge=_flashState.bridge;if(flashBridge){var htmlBridge=_getHtmlBridge(flashBridge);if(htmlBridge){if(_flashState.pluginType==="activex"&&"readyState"in flashBridge){flashBridge.style.display="none";(function removeSwfFromIE(){if(flashBridge.readyState===4){for(var prop in flashBridge){if(typeof flashBridge[prop]==="function"){flashBridge[prop]=null}}if(flashBridge.parentNode){flashBridge.parentNode.removeChild(flashBridge)}if(htmlBridge.parentNode){htmlBridge.parentNode.removeChild(htmlBridge)}}else{_setTimeout(removeSwfFromIE,10)}})()}else{if(flashBridge.parentNode){flashBridge.parentNode.removeChild(flashBridge)}if(htmlBridge.parentNode){htmlBridge.parentNode.removeChild(htmlBridge)}}}_clearTimeoutsAndPolling();_flashState.ready=null;_flashState.bridge=null;_flashState.deactivated=null;_zcSwfVersion=undefined}};var _mapClipDataToFlash=function(clipData){var newClipData={},formatMap={};if(!(typeof clipData==="object"&&clipData)){return}for(var dataFormat in clipData){if(dataFormat&&_hasOwn.call(clipData,dataFormat)&&typeof clipData[dataFormat]==="string"&&clipData[dataFormat]){switch(dataFormat.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":newClipData.text=clipData[dataFormat];formatMap.text=dataFormat;break;case"text/html":case"html":case"air:html":case"flash:html":newClipData.html=clipData[dataFormat];formatMap.html=dataFormat;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":newClipData.rtf=clipData[dataFormat];formatMap.rtf=dataFormat;break;default:break}}}return{data:newClipData,formatMap:formatMap}};var _mapClipResultsFromFlash=function(clipResults,formatMap){if(!(typeof clipResults==="object"&&clipResults&&typeof formatMap==="object"&&formatMap)){return clipResults}var newResults={};for(var prop in clipResults){if(_hasOwn.call(clipResults,prop)){if(prop==="errors"){newResults[prop]=clipResults[prop]?clipResults[prop].slice():[];for(var i=0,len=newResults[prop].length;i<len;i++){newResults[prop][i].format=formatMap[newResults[prop][i].format]}}else if(prop!=="success"&&prop!=="data"){newResults[prop]=clipResults[prop]}else{newResults[prop]={};var tmpHash=clipResults[prop];for(var dataFormat in tmpHash){if(dataFormat&&_hasOwn.call(tmpHash,dataFormat)&&_hasOwn.call(formatMap,dataFormat)){newResults[prop][formatMap[dataFormat]]=tmpHash[dataFormat]}}}}}return newResults};var _cacheBust=function(path,options){var cacheBust=options==null||options&&options.cacheBust===true;if(cacheBust){return(path.indexOf("?")===-1?"?":"&")+"noCache="+_now()}else{return""}};var _vars=function(options){var i,len,domain,domains,str="",trustedOriginsExpanded=[];if(options.trustedDomains){if(typeof options.trustedDomains==="string"){domains=[options.trustedDomains]}else if(typeof options.trustedDomains==="object"&&"length"in options.trustedDomains){domains=options.trustedDomains}}if(domains&&domains.length){for(i=0,len=domains.length;i<len;i++){if(_hasOwn.call(domains,i)&&domains[i]&&typeof domains[i]==="string"){domain=_extractDomain(domains[i]);if(!domain){continue}if(domain==="*"){trustedOriginsExpanded.length=0;trustedOriginsExpanded.push(domain);break}trustedOriginsExpanded.push.apply(trustedOriginsExpanded,[domain,"//"+domain,_window.location.protocol+"//"+domain])}}}if(trustedOriginsExpanded.length){str+="trustedOrigins="+_encodeURIComponent(trustedOriginsExpanded.join(","))}if(options.forceEnhancedClipboard===true){str+=(str?"&":"")+"forceEnhancedClipboard=true"}if(typeof options.swfObjectId==="string"&&options.swfObjectId){str+=(str?"&":"")+"swfObjectId="+_encodeURIComponent(options.swfObjectId)}if(typeof options.jsVersion==="string"&&options.jsVersion){str+=(str?"&":"")+"jsVersion="+_encodeURIComponent(options.jsVersion)}return str};var _extractDomain=function(originOrUrl){if(originOrUrl==null||originOrUrl===""){return null}originOrUrl=originOrUrl.replace(/^\s+|\s+$/g,"");if(originOrUrl===""){return null}var protocolIndex=originOrUrl.indexOf("//");originOrUrl=protocolIndex===-1?originOrUrl:originOrUrl.slice(protocolIndex+2);var pathIndex=originOrUrl.indexOf("/");originOrUrl=pathIndex===-1?originOrUrl:protocolIndex===-1||pathIndex===0?null:originOrUrl.slice(0,pathIndex);if(originOrUrl&&originOrUrl.slice(-4).toLowerCase()===".swf"){return null}return originOrUrl||null};var _determineScriptAccess=function(){var _extractAllDomains=function(origins){var i,len,tmp,resultsArray=[];if(typeof origins==="string"){origins=[origins]}if(!(typeof origins==="object"&&origins&&typeof origins.length==="number")){return resultsArray}for(i=0,len=origins.length;i<len;i++){if(_hasOwn.call(origins,i)&&(tmp=_extractDomain(origins[i]))){if(tmp==="*"){resultsArray.length=0;resultsArray.push("*");break}if(resultsArray.indexOf(tmp)===-1){resultsArray.push(tmp)}}}return resultsArray};return function(currentDomain,configOptions){var swfDomain=_extractDomain(configOptions.swfPath);if(swfDomain===null){swfDomain=currentDomain}var trustedDomains=_extractAllDomains(configOptions.trustedDomains);var len=trustedDomains.length;if(len>0){if(len===1&&trustedDomains[0]==="*"){return"always"}if(trustedDomains.indexOf(currentDomain)!==-1){if(len===1&&currentDomain===swfDomain){return"sameDomain"}return"always"}}return"never"}}();var _safeActiveElement=function(){try{return _document.activeElement}catch(err){return null}};var _addClass=function(element,value){var c,cl,className,classNames=[];if(typeof value==="string"&&value){classNames=value.split(/\s+/)}if(element&&element.nodeType===1&&classNames.length>0){if(element.classList){for(c=0,cl=classNames.length;c<cl;c++){element.classList.add(classNames[c])}}else if(element.hasOwnProperty("className")){className=" "+element.className+" ";for(c=0,cl=classNames.length;c<cl;c++){if(className.indexOf(" "+classNames[c]+" ")===-1){className+=classNames[c]+" "}}element.className=className.replace(/^\s+|\s+$/g,"")}}return element};var _removeClass=function(element,value){var c,cl,className,classNames=[];if(typeof value==="string"&&value){classNames=value.split(/\s+/)}if(element&&element.nodeType===1&&classNames.length>0){if(element.classList&&element.classList.length>0){for(c=0,cl=classNames.length;c<cl;c++){element.classList.remove(classNames[c])}}else if(element.className){className=(" "+element.className+" ").replace(/[\r\n\t]/g," ");for(c=0,cl=classNames.length;c<cl;c++){className=className.replace(" "+classNames[c]+" "," ")}element.className=className.replace(/^\s+|\s+$/g,"")}}return element};var _getStyle=function(el,prop){var value=_getComputedStyle(el,null).getPropertyValue(prop);if(prop==="cursor"){if(!value||value==="auto"){if(el.nodeName==="A"){return"pointer"}}}return value};var _getElementPosition=function(el){var pos={left:0,top:0,width:0,height:0};if(el.getBoundingClientRect){var elRect=el.getBoundingClientRect();var pageXOffset=_window.pageXOffset;var pageYOffset=_window.pageYOffset;var leftBorderWidth=_document.documentElement.clientLeft||0;var topBorderWidth=_document.documentElement.clientTop||0;var leftBodyOffset=0;var topBodyOffset=0;if(_getStyle(_document.body,"position")==="relative"){var bodyRect=_document.body.getBoundingClientRect();var htmlRect=_document.documentElement.getBoundingClientRect();leftBodyOffset=bodyRect.left-htmlRect.left||0;topBodyOffset=bodyRect.top-htmlRect.top||0}pos.left=elRect.left+pageXOffset-leftBorderWidth-leftBodyOffset;pos.top=elRect.top+pageYOffset-topBorderWidth-topBodyOffset;pos.width="width"in elRect?elRect.width:elRect.right-elRect.left;pos.height="height"in elRect?elRect.height:elRect.bottom-elRect.top}return pos};var _isElementVisible=function(el){if(!el){return false}var styles=_getComputedStyle(el,null);var hasCssHeight=_parseFloat(styles.height)>0;var hasCssWidth=_parseFloat(styles.width)>0;var hasCssTop=_parseFloat(styles.top)>=0;var hasCssLeft=_parseFloat(styles.left)>=0;var cssKnows=hasCssHeight&&hasCssWidth&&hasCssTop&&hasCssLeft;var rect=cssKnows?null:_getElementPosition(el);var isVisible=styles.display!=="none"&&styles.visibility!=="collapse"&&(cssKnows||!!rect&&(hasCssHeight||rect.height>0)&&(hasCssWidth||rect.width>0)&&(hasCssTop||rect.top>=0)&&(hasCssLeft||rect.left>=0));return isVisible};var _clearTimeoutsAndPolling=function(){_clearTimeout(_flashCheckTimeout);_flashCheckTimeout=0;_clearInterval(_swfFallbackCheckInterval);_swfFallbackCheckInterval=0};var _reposition=function(){var htmlBridge;if(_currentElement&&(htmlBridge=_getHtmlBridge(_flashState.bridge))){var pos=_getElementPosition(_currentElement);_extend(htmlBridge.style,{width:pos.width+"px",height:pos.height+"px",top:pos.top+"px",left:pos.left+"px",zIndex:""+_getSafeZIndex(_globalConfig.zIndex)})}};var _setHandCursor=function(enabled){if(_flashState.ready===true){if(_flashState.bridge&&typeof _flashState.bridge.setHandCursor==="function"){_flashState.bridge.setHandCursor(enabled)}else{_flashState.ready=false}}};var _getSafeZIndex=function(val){if(/^(?:auto|inherit)$/.test(val)){return val}var zIndex;if(typeof val==="number"&&!_isNaN(val)){zIndex=val}else if(typeof val==="string"){zIndex=_getSafeZIndex(_parseInt(val,10))}return typeof zIndex==="number"?zIndex:"auto"};var _detectSandbox=function(doNotReassessFlashSupport){var effectiveScriptOrigin,frame,frameError,previousState=_flashState.sandboxed,isSandboxed=null;doNotReassessFlashSupport=doNotReassessFlashSupport===true;if(_pageIsFramed===false){isSandboxed=false}else{try{frame=window.frameElement||null}catch(e){frameError={name:e.name,message:e.message}}if(frame&&frame.nodeType===1&&frame.nodeName==="IFRAME"){try{isSandboxed=frame.hasAttribute("sandbox")}catch(e){isSandboxed=null}}else{try{effectiveScriptOrigin=document.domain||null}catch(e){effectiveScriptOrigin=null}if(effectiveScriptOrigin===null||frameError&&frameError.name==="SecurityError"&&/(^|[\s\(\[@])sandbox(es|ed|ing|[\s\.,!\)\]@]|$)/.test(frameError.message.toLowerCase())){isSandboxed=true}}}_flashState.sandboxed=isSandboxed;if(previousState!==isSandboxed&&!doNotReassessFlashSupport){_detectFlashSupport(_ActiveXObject)}return isSandboxed};var _detectFlashSupport=function(ActiveXObject){var plugin,ax,mimeType,hasFlash=false,isActiveX=false,isPPAPI=false,flashVersion="";function parseFlashVersion(desc){var matches=desc.match(/[\d]+/g);matches.length=3;return matches.join(".")}function isPepperFlash(flashPlayerFileName){return!!flashPlayerFileName&&(flashPlayerFileName=flashPlayerFileName.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(flashPlayerFileName)||flashPlayerFileName.slice(-13)==="chrome.plugin")}function inspectPlugin(plugin){if(plugin){hasFlash=true;if(plugin.version){flashVersion=parseFlashVersion(plugin.version)}if(!flashVersion&&plugin.description){flashVersion=parseFlashVersion(plugin.description)}if(plugin.filename){isPPAPI=isPepperFlash(plugin.filename)}}}if(_navigator.plugins&&_navigator.plugins.length){plugin=_navigator.plugins["Shockwave Flash"];inspectPlugin(plugin);if(_navigator.plugins["Shockwave Flash 2.0"]){hasFlash=true;flashVersion="2.0.0.11"}}else if(_navigator.mimeTypes&&_navigator.mimeTypes.length){mimeType=_navigator.mimeTypes["application/x-shockwave-flash"];plugin=mimeType&&mimeType.enabledPlugin;inspectPlugin(plugin)}else if(typeof ActiveXObject!=="undefined"){isActiveX=true;try{ax=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");hasFlash=true;flashVersion=parseFlashVersion(ax.GetVariable("$version"))}catch(e1){try{ax=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");hasFlash=true;flashVersion="6.0.21"}catch(e2){try{ax=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");hasFlash=true;flashVersion=parseFlashVersion(ax.GetVariable("$version"))}catch(e3){isActiveX=false}}}}_flashState.disabled=hasFlash!==true;_flashState.outdated=flashVersion&&_parseFloat(flashVersion)<_parseFloat(_minimumFlashVersion);_flashState.version=flashVersion||"0.0.0";_flashState.pluginType=isPPAPI?"pepper":isActiveX?"activex":hasFlash?"netscape":"unknown"};_detectFlashSupport(_ActiveXObject);_detectSandbox(true);var ZeroClipboard=function(){if(!(this instanceof ZeroClipboard)){return new ZeroClipboard}if(typeof ZeroClipboard._createClient==="function"){ZeroClipboard._createClient.apply(this,_args(arguments))}};_defineProperty(ZeroClipboard,"version",{value:"2.2.0",writable:false,configurable:true,enumerable:true});ZeroClipboard.config=function(){return _config.apply(this,_args(arguments))};ZeroClipboard.state=function(){return _state.apply(this,_args(arguments))};ZeroClipboard.isFlashUnusable=function(){return _isFlashUnusable.apply(this,_args(arguments))};ZeroClipboard.on=function(){return _on.apply(this,_args(arguments))};ZeroClipboard.off=function(){return _off.apply(this,_args(arguments))};ZeroClipboard.handlers=function(){return _listeners.apply(this,_args(arguments))};ZeroClipboard.emit=function(){return _emit.apply(this,_args(arguments))};ZeroClipboard.create=function(){return _create.apply(this,_args(arguments))};ZeroClipboard.destroy=function(){return _destroy.apply(this,_args(arguments))};ZeroClipboard.setData=function(){return _setData.apply(this,_args(arguments))};ZeroClipboard.clearData=function(){return _clearData.apply(this,_args(arguments))};ZeroClipboard.getData=function(){return _getData.apply(this,_args(arguments))};ZeroClipboard.focus=ZeroClipboard.activate=function(){return _focus.apply(this,_args(arguments))};ZeroClipboard.blur=ZeroClipboard.deactivate=function(){return _blur.apply(this,_args(arguments))};ZeroClipboard.activeElement=function(){return _activeElement.apply(this,_args(arguments))};var _clientIdCounter=0;var _clientMeta={};var _elementIdCounter=0;var _elementMeta={};var _mouseHandlers={};_extend(_globalConfig,{autoActivate:true});var _clientConstructor=function(elements){var client=this;client.id=""+_clientIdCounter++;_clientMeta[client.id]={instance:client,elements:[],handlers:{}};if(elements){client.clip(elements)}ZeroClipboard.on("*",function(event){return client.emit(event)});ZeroClipboard.on("destroy",function(){client.destroy()});ZeroClipboard.create()};var _clientOn=function(eventType,listener){var i,len,events,added={},meta=_clientMeta[this.id],handlers=meta&&meta.handlers;if(!meta){throw new Error("Attempted to add new listener(s) to a destroyed ZeroClipboard client instance")}if(typeof eventType==="string"&&eventType){events=eventType.toLowerCase().split(/\s+/)}else if(typeof eventType==="object"&&eventType&&typeof listener==="undefined"){for(i in eventType){if(_hasOwn.call(eventType,i)&&typeof i==="string"&&i&&typeof eventType[i]==="function"){this.on(i,eventType[i])}}}if(events&&events.length){for(i=0,len=events.length;i<len;i++){eventType=events[i].replace(/^on/,"");added[eventType]=true;if(!handlers[eventType]){handlers[eventType]=[]}handlers[eventType].push(listener)}if(added.ready&&_flashState.ready){this.emit({type:"ready",client:this})}if(added.error){for(i=0,len=_flashStateErrorNames.length;i<len;i++){if(_flashState[_flashStateErrorNames[i].replace(/^flash-/,"")]){this.emit({type:"error",name:_flashStateErrorNames[i],client:this});break}}if(_zcSwfVersion!==undefined&&ZeroClipboard.version!==_zcSwfVersion){this.emit({type:"error",name:"version-mismatch",jsVersion:ZeroClipboard.version,swfVersion:_zcSwfVersion})}}}return this};var _clientOff=function(eventType,listener){var i,len,foundIndex,events,perEventHandlers,meta=_clientMeta[this.id],handlers=meta&&meta.handlers;if(!handlers){return this}if(arguments.length===0){events=_keys(handlers)}else if(typeof eventType==="string"&&eventType){events=eventType.split(/\s+/)}else if(typeof eventType==="object"&&eventType&&typeof listener==="undefined"){for(i in eventType){if(_hasOwn.call(eventType,i)&&typeof i==="string"&&i&&typeof eventType[i]==="function"){this.off(i,eventType[i])}}}if(events&&events.length){for(i=0,len=events.length;i<len;i++){eventType=events[i].toLowerCase().replace(/^on/,"");perEventHandlers=handlers[eventType];if(perEventHandlers&&perEventHandlers.length){if(listener){foundIndex=perEventHandlers.indexOf(listener);while(foundIndex!==-1){perEventHandlers.splice(foundIndex,1);foundIndex=perEventHandlers.indexOf(listener,foundIndex)}}else{perEventHandlers.length=0}}}}return this};var _clientListeners=function(eventType){var copy=null,handlers=_clientMeta[this.id]&&_clientMeta[this.id].handlers;if(handlers){if(typeof eventType==="string"&&eventType){copy=handlers[eventType]?handlers[eventType].slice(0):[]}else{copy=_deepCopy(handlers)}}return copy};var _clientEmit=function(event){if(_clientShouldEmit.call(this,event)){if(typeof event==="object"&&event&&typeof event.type==="string"&&event.type){event=_extend({},event)}var eventCopy=_extend({},_createEvent(event),{client:this});_clientDispatchCallbacks.call(this,eventCopy)}return this};var _clientClip=function(elements){if(!_clientMeta[this.id]){throw new Error("Attempted to clip element(s) to a destroyed ZeroClipboard client instance")}elements=_prepClip(elements);for(var i=0;i<elements.length;i++){if(_hasOwn.call(elements,i)&&elements[i]&&elements[i].nodeType===1){if(!elements[i].zcClippingId){elements[i].zcClippingId="zcClippingId_"+_elementIdCounter++;_elementMeta[elements[i].zcClippingId]=[this.id];if(_globalConfig.autoActivate===true){_addMouseHandlers(elements[i])}}else if(_elementMeta[elements[i].zcClippingId].indexOf(this.id)===-1){_elementMeta[elements[i].zcClippingId].push(this.id)}var clippedElements=_clientMeta[this.id]&&_clientMeta[this.id].elements;if(clippedElements.indexOf(elements[i])===-1){clippedElements.push(elements[i])}}}return this};var _clientUnclip=function(elements){var meta=_clientMeta[this.id];if(!meta){return this}var clippedElements=meta.elements;var arrayIndex;if(typeof elements==="undefined"){elements=clippedElements.slice(0)}else{elements=_prepClip(elements)}for(var i=elements.length;i--;){if(_hasOwn.call(elements,i)&&elements[i]&&elements[i].nodeType===1){arrayIndex=0;while((arrayIndex=clippedElements.indexOf(elements[i],arrayIndex))!==-1){clippedElements.splice(arrayIndex,1)}var clientIds=_elementMeta[elements[i].zcClippingId];if(clientIds){arrayIndex=0;while((arrayIndex=clientIds.indexOf(this.id,arrayIndex))!==-1){clientIds.splice(arrayIndex,1)}if(clientIds.length===0){if(_globalConfig.autoActivate===true){_removeMouseHandlers(elements[i])}delete elements[i].zcClippingId}}}}return this};var _clientElements=function(){var meta=_clientMeta[this.id];return meta&&meta.elements?meta.elements.slice(0):[]};var _clientDestroy=function(){if(!_clientMeta[this.id]){return}this.unclip();this.off();delete _clientMeta[this.id]};var _clientShouldEmit=function(event){if(!(event&&event.type)){return false}if(event.client&&event.client!==this){return false}var meta=_clientMeta[this.id];var clippedEls=meta&&meta.elements;var hasClippedEls=!!clippedEls&&clippedEls.length>0;var goodTarget=!event.target||hasClippedEls&&clippedEls.indexOf(event.target)!==-1;var goodRelTarget=event.relatedTarget&&hasClippedEls&&clippedEls.indexOf(event.relatedTarget)!==-1;var goodClient=event.client&&event.client===this;if(!meta||!(goodTarget||goodRelTarget||goodClient)){return false}return true};var _clientDispatchCallbacks=function(event){var meta=_clientMeta[this.id];if(!(typeof event==="object"&&event&&event.type&&meta)){return}var async=_shouldPerformAsync(event);var wildcardTypeHandlers=meta&&meta.handlers["*"]||[];var specificTypeHandlers=meta&&meta.handlers[event.type]||[];var handlers=wildcardTypeHandlers.concat(specificTypeHandlers);if(handlers&&handlers.length){var i,len,func,context,eventCopy,originalContext=this;for(i=0,len=handlers.length;i<len;i++){func=handlers[i];context=originalContext;if(typeof func==="string"&&typeof _window[func]==="function"){func=_window[func]}if(typeof func==="object"&&func&&typeof func.handleEvent==="function"){context=func;func=func.handleEvent}if(typeof func==="function"){eventCopy=_extend({},event);_dispatchCallback(func,context,[eventCopy],async)}}}};var _prepClip=function(elements){if(typeof elements==="string"){elements=[]}return typeof elements.length!=="number"?[elements]:elements};var _addMouseHandlers=function(element){if(!(element&&element.nodeType===1)){return}var _suppressMouseEvents=function(event){if(!(event||(event=_window.event))){return}if(event._source!=="js"){event.stopImmediatePropagation();event.preventDefault()}delete event._source};var _elementMouseOver=function(event){if(!(event||(event=_window.event))){return}_suppressMouseEvents(event);ZeroClipboard.focus(element)};element.addEventListener("mouseover",_elementMouseOver,false);element.addEventListener("mouseout",_suppressMouseEvents,false);element.addEventListener("mouseenter",_suppressMouseEvents,false);element.addEventListener("mouseleave",_suppressMouseEvents,false);element.addEventListener("mousemove",_suppressMouseEvents,false);_mouseHandlers[element.zcClippingId]={mouseover:_elementMouseOver,mouseout:_suppressMouseEvents,mouseenter:_suppressMouseEvents,mouseleave:_suppressMouseEvents,mousemove:_suppressMouseEvents}};var _removeMouseHandlers=function(element){if(!(element&&element.nodeType===1)){return}var mouseHandlers=_mouseHandlers[element.zcClippingId];if(!(typeof mouseHandlers==="object"&&mouseHandlers)){return}var key,val,mouseEvents=["move","leave","enter","out","over"];for(var i=0,len=mouseEvents.length;i<len;i++){key="mouse"+mouseEvents[i];val=mouseHandlers[key];if(typeof val==="function"){element.removeEventListener(key,val,false)}}delete _mouseHandlers[element.zcClippingId]};ZeroClipboard._createClient=function(){_clientConstructor.apply(this,_args(arguments))};ZeroClipboard.prototype.on=function(){return _clientOn.apply(this,_args(arguments))};ZeroClipboard.prototype.off=function(){return _clientOff.apply(this,_args(arguments))};ZeroClipboard.prototype.handlers=function(){return _clientListeners.apply(this,_args(arguments))};ZeroClipboard.prototype.emit=function(){return _clientEmit.apply(this,_args(arguments))};ZeroClipboard.prototype.clip=function(){return _clientClip.apply(this,_args(arguments))};ZeroClipboard.prototype.unclip=function(){return _clientUnclip.apply(this,_args(arguments))};ZeroClipboard.prototype.elements=function(){return _clientElements.apply(this,_args(arguments))
};ZeroClipboard.prototype.destroy=function(){return _clientDestroy.apply(this,_args(arguments))};ZeroClipboard.prototype.setText=function(text){if(!_clientMeta[this.id]){throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance")}ZeroClipboard.setData("text/plain",text);return this};ZeroClipboard.prototype.setHtml=function(html){if(!_clientMeta[this.id]){throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance")}ZeroClipboard.setData("text/html",html);return this};ZeroClipboard.prototype.setRichText=function(richText){if(!_clientMeta[this.id]){throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance")}ZeroClipboard.setData("application/rtf",richText);return this};ZeroClipboard.prototype.setData=function(){if(!_clientMeta[this.id]){throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance")}ZeroClipboard.setData.apply(this,_args(arguments));return this};ZeroClipboard.prototype.clearData=function(){if(!_clientMeta[this.id]){throw new Error("Attempted to clear pending clipboard data from a destroyed ZeroClipboard client instance")}ZeroClipboard.clearData.apply(this,_args(arguments));return this};ZeroClipboard.prototype.getData=function(){if(!_clientMeta[this.id]){throw new Error("Attempted to get pending clipboard data from a destroyed ZeroClipboard client instance")}return ZeroClipboard.getData.apply(this,_args(arguments))};if(typeof define==="function"&&define.amd){define(function(){return ZeroClipboard})}else if(typeof module==="object"&&module&&typeof module.exports==="object"&&module.exports){module.exports=ZeroClipboard}else{window.ZeroClipboard=ZeroClipboard}})(function(){return this||window}());Ibles.package("Ibles.views","Ibles.models");Ibles.models.Achievements=Backbone.Model.extend({deferred:null,authorIds:[],initialize:function(options){var self=this;this.deferred=$.Deferred();if(options&&options.authorIds){this.authorIds=options.authorIds}},addAuthor:function(authorId){this.authorIds.push(authorId)},clearAuthors:function(){this.set({authorIds:[]})},fetch:function(){var self=this;if(this.authorIds&&this.authorIds.length){Ibles.API.getRequest("getAuthorsStats",_.map(this.authorIds,function(authorId){return{name:"id",value:authorId}}),{success:function(data){self.set(data);self.deferred.resolve(data)},error:function(){self.deferred.reject()}})}},fetchForAuthor:function(authorId){var deferred=$.Deferred(),self=this;this.deferred.done(function(data){var authorStats=data["authorsStats"];if(authorStats.hasOwnProperty(authorId)){deferred.resolve(authorStats[authorId])}else{deferred.resolve({})}}).fail(function(){deferred.reject({})});return deferred.promise()}});Ibles.views.Achievement=Backbone.View.extend({achievementCriteria:{views:{bronze:1e4,silver:1e6,gold:1e7},comments:{bronze:100,silver:500,gold:1e3},featured:{bronze:1,silver:10,gold:100}},template:_.template(Ibles.JST["achievement"]),className:"author-achievements",attributes:function(){return{"data-toggle":"popover",style:"display:none"}},render:function(){this.$el.html(this.template());this.renderAchievements();return this},renderAchievements:function(){var properties={views:this.model.get("totalInstructableViews")+this.model.get("totalGuidesViews"),featured:this.model.get("featuredInstructablesCount")+this.model.get("featuredGuideCount"),comments:this.model.get("numCommentsMade")},authorId=this.model.get("authorId"),self=this;for(var key in properties){if(properties.hasOwnProperty(key)){self.addAchievement(authorId,key,properties[key])}}this.$el.popover({container:"body",placement:"top",trigger:"hover",html:true,content:this.$(".achievement-popover-wrapper").html(),template:'<div class="popover achievement-popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'})},addAchievement:function(authorId,achievementType,authorStatProperty){var achievementCriteria=this.achievementCriteria;if(authorStatProperty>=achievementCriteria[achievementType].gold){this.renderMedallion("gold",achievementType)}else if(authorStatProperty>=achievementCriteria[achievementType].silver){this.renderMedallion("silver",achievementType)}else if(authorStatProperty>=achievementCriteria[achievementType].bronze){this.renderMedallion("bronze",achievementType)}},renderMedallion:function(medalType,achievementType){var $achievementWrapper=this.$el,$achievementIcon=$achievementWrapper.find(".achievement-"+achievementType),$achievementPopoverWrapper=$achievementWrapper.find(".achievement-popover-wrapper"),$achievementPopoverCoinWrapper=$achievementPopoverWrapper.find(".coin-"+achievementType+"-wrapper"),$achievementCoinIcon=$achievementPopoverWrapper.find("i.achievement-coin-"+achievementType);if(medalType==="gold"||medalType==="silver"||medalType==="bronze"){$achievementIcon.addClass("coin-"+medalType).show();$achievementCoinIcon.addClass("coin-"+achievementType+"-"+medalType);$achievementPopoverCoinWrapper.find("p").addClass("coin-"+medalType).text(medalType+" Medal");$achievementPopoverCoinWrapper.css("display","inline-block");if($achievementWrapper.is(":hidden"))$achievementWrapper.show()}}});(function(){function a(a){this._value=a}function b(a,b,c,d){var e,f,g=Math.pow(10,b);return f=(c(a*g)/g).toFixed(b),d&&(e=new RegExp("0{1,"+d+"}$"),f=f.replace(e,"")),f}function c(a,b,c){var d;return d=b.indexOf("$")>-1?e(a,b,c):b.indexOf("%")>-1?f(a,b,c):b.indexOf(":")>-1?g(a,b):i(a._value,b,c)}function d(a,b){var c,d,e,f,g,i=b,j=["KB","MB","GB","TB","PB","EB","ZB","YB"],k=!1;if(b.indexOf(":")>-1)a._value=h(b);else if(b===q)a._value=0;else{for("."!==o[p].delimiters.decimal&&(b=b.replace(/\./g,"").replace(o[p].delimiters.decimal,".")),c=new RegExp("[^a-zA-Z]"+o[p].abbreviations.thousand+"(?:\\)|(\\"+o[p].currency.symbol+")?(?:\\))?)?$"),d=new RegExp("[^a-zA-Z]"+o[p].abbreviations.million+"(?:\\)|(\\"+o[p].currency.symbol+")?(?:\\))?)?$"),e=new RegExp("[^a-zA-Z]"+o[p].abbreviations.billion+"(?:\\)|(\\"+o[p].currency.symbol+")?(?:\\))?)?$"),f=new RegExp("[^a-zA-Z]"+o[p].abbreviations.trillion+"(?:\\)|(\\"+o[p].currency.symbol+")?(?:\\))?)?$"),g=0;g<=j.length&&!(k=b.indexOf(j[g])>-1?Math.pow(1024,g+1):!1);g++);a._value=(k?k:1)*(i.match(c)?Math.pow(10,3):1)*(i.match(d)?Math.pow(10,6):1)*(i.match(e)?Math.pow(10,9):1)*(i.match(f)?Math.pow(10,12):1)*(b.indexOf("%")>-1?.01:1)*((b.split("-").length+Math.min(b.split("(").length-1,b.split(")").length-1))%2?1:-1)*Number(b.replace(/[^0-9\.]+/g,"")),a._value=k?Math.ceil(a._value):a._value}return a._value}function e(a,b,c){var d,e,f=b.indexOf("$"),g=b.indexOf("("),h=b.indexOf("-"),j="";return b.indexOf(" $")>-1?(j=" ",b=b.replace(" $","")):b.indexOf("$ ")>-1?(j=" ",b=b.replace("$ ","")):b=b.replace("$",""),e=i(a._value,b,c),1>=f?e.indexOf("(")>-1||e.indexOf("-")>-1?(e=e.split(""),d=1,(g>f||h>f)&&(d=0),e.splice(d,0,o[p].currency.symbol+j),e=e.join("")):e=o[p].currency.symbol+j+e:e.indexOf(")")>-1?(e=e.split(""),e.splice(-1,0,j+o[p].currency.symbol),e=e.join("")):e=e+j+o[p].currency.symbol,e}function f(a,b,c){var d,e="",f=100*a._value;return b.indexOf(" %")>-1?(e=" ",b=b.replace(" %","")):b=b.replace("%",""),d=i(f,b,c),d.indexOf(")")>-1?(d=d.split(""),d.splice(-1,0,e+"%"),d=d.join("")):d=d+e+"%",d}function g(a){var b=Math.floor(a._value/60/60),c=Math.floor((a._value-60*b*60)/60),d=Math.round(a._value-60*b*60-60*c);return b+":"+(10>c?"0"+c:c)+":"+(10>d?"0"+d:d)}function h(a){var b=a.split(":"),c=0;return 3===b.length?(c+=60*Number(b[0])*60,c+=60*Number(b[1]),c+=Number(b[2])):2===b.length&&(c+=60*Number(b[0]),c+=Number(b[1])),Number(c)}function i(a,c,d){var e,f,g,h,i,j,k=!1,l=!1,m=!1,n="",r=!1,s=!1,t=!1,u=!1,v=!1,w="",x="",y=Math.abs(a),z=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],A="",B=!1;if(0===a&&null!==q)return q;if(c.indexOf("(")>-1?(k=!0,c=c.slice(1,-1)):c.indexOf("+")>-1&&(l=!0,c=c.replace(/\+/g,"")),c.indexOf("a")>-1&&(r=c.indexOf("aK")>=0,s=c.indexOf("aM")>=0,t=c.indexOf("aB")>=0,u=c.indexOf("aT")>=0,v=r||s||t||u,c.indexOf(" a")>-1?(n=" ",c=c.replace(" a","")):c=c.replace("a",""),y>=Math.pow(10,12)&&!v||u?(n+=o[p].abbreviations.trillion,a/=Math.pow(10,12)):y<Math.pow(10,12)&&y>=Math.pow(10,9)&&!v||t?(n+=o[p].abbreviations.billion,a/=Math.pow(10,9)):y<Math.pow(10,9)&&y>=Math.pow(10,6)&&!v||s?(n+=o[p].abbreviations.million,a/=Math.pow(10,6)):(y<Math.pow(10,6)&&y>=Math.pow(10,3)&&!v||r)&&(n+=o[p].abbreviations.thousand,a/=Math.pow(10,3))),c.indexOf("b")>-1)for(c.indexOf(" b")>-1?(w=" ",c=c.replace(" b","")):c=c.replace("b",""),g=0;g<=z.length;g++)if(e=Math.pow(1024,g),f=Math.pow(1024,g+1),a>=e&&f>a){w+=z[g],e>0&&(a/=e);break}return c.indexOf("o")>-1&&(c.indexOf(" o")>-1?(x=" ",c=c.replace(" o","")):c=c.replace("o",""),x+=o[p].ordinal(a)),c.indexOf("[.]")>-1&&(m=!0,c=c.replace("[.]",".")),h=a.toString().split(".")[0],i=c.split(".")[1],j=c.indexOf(","),i?(i.indexOf("[")>-1?(i=i.replace("]",""),i=i.split("["),A=b(a,i[0].length+i[1].length,d,i[1].length)):A=b(a,i.length,d),h=A.split(".")[0],A=A.split(".")[1].length?o[p].delimiters.decimal+A.split(".")[1]:"",m&&0===Number(A.slice(1))&&(A="")):h=b(a,null,d),h.indexOf("-")>-1&&(h=h.slice(1),B=!0),j>-1&&(h=h.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+o[p].delimiters.thousands)),0===c.indexOf(".")&&(h=""),(k&&B?"(":"")+(!k&&B?"-":"")+(!B&&l?"+":"")+h+A+(x?x:"")+(n?n:"")+(w?w:"")+(k&&B?")":"")}function j(a,b){o[a]=b}function k(a){var b=a.toString().split(".");return b.length<2?1:Math.pow(10,b[1].length)}function l(){var a=Array.prototype.slice.call(arguments);return a.reduce(function(a,b){var c=k(a),d=k(b);return c>d?c:d},-1/0)}var m,n="1.5.3",o={},p="en",q=null,r="0,0",s="undefined"!=typeof module&&module.exports;m=function(b){return m.isNumeral(b)?b=b.value():0===b||"undefined"==typeof b?b=0:Number(b)||(b=m.fn.unformat(b)),new a(Number(b))},m.version=n,m.isNumeral=function(b){return b instanceof a},m.language=function(a,b){if(!a)return p;if(a&&!b){if(!o[a])throw new Error("Unknown language : "+a);p=a}return(b||!o[a])&&j(a,b),m},m.languageData=function(a){if(!a)return o[p];if(!o[a])throw new Error("Unknown language : "+a);return o[a]},m.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(a){var b=a%10;return 1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th"},currency:{symbol:"$"}}),m.zeroFormat=function(a){q="string"==typeof a?a:null},m.defaultFormat=function(a){r="string"==typeof a?a:"0.0"},"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(a,b){"use strict";if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof a)throw new TypeError(a+" is not a function");var c,d,e=this.length>>>0,f=!1;for(1<arguments.length&&(d=b,f=!0),c=0;e>c;++c)this.hasOwnProperty(c)&&(f?d=a(d,this[c],c,this):(d=this[c],f=!0));if(!f)throw new TypeError("Reduce of empty array with no initial value");return d}),m.fn=a.prototype={clone:function(){return m(this)},format:function(a,b){return c(this,a?a:r,void 0!==b?b:Math.round)},unformat:function(a){return"[object Number]"===Object.prototype.toString.call(a)?a:d(this,a?a:r)},value:function(){return this._value},valueOf:function(){return this._value},set:function(a){return this._value=Number(a),this},add:function(a){function b(a,b){return a+c*b}var c=l.call(null,this._value,a);return this._value=[this._value,a].reduce(b,0)/c,this},subtract:function(a){function b(a,b){return a-c*b}var c=l.call(null,this._value,a);return this._value=[a].reduce(b,this._value*c)/c,this},multiply:function(a){function b(a,b){var c=l(a,b);return a*c*b*c/(c*c)}return this._value=[this._value,a].reduce(b,1),this},divide:function(a){function b(a,b){var c=l(a,b);return a*c/(b*c)}return this._value=[this._value,a].reduce(b),this},difference:function(a){return Math.abs(m(this._value).subtract(a).value())}},s&&(module.exports=m),"undefined"==typeof ender&&(this.numeral=m),"function"==typeof define&&define.amd&&define([],function(){return m})}).call(this);(function($,_){var StatsCard=function(el,options){this.init(el,options)};StatsCard.prototype={constructor:StatsCard,template:_.template(Ibles.JST["statscard"]),init:function(el,options){this.$element=$(el);this.screenName=this.$element.data("screenname")?this.$element.data("screenname"):options.screenName;this.loginURL=options.loginURL;this.author=null;this.intentTimeout=null;this.options=$.extend({placement:"right",trigger:"manual",html:true});this.createPopover({content:Ibles.locale.uiElements.loading})},createPopover:function(options){this.$element.popover($.extend({},this.options,options)).hover($.proxy(this.mouseInTrigger,this),$.proxy(this.mouseOut,this))},getPopover:function(){return this.$element.data("popover")},getPopoverContainer:function(){return this.$element.data("popover").tip()},showPopover:function(){this.getPopover().show()},fetchAuthor:function(callback){if(!this.contentRequested){var apiParams={lite:"true",screenName:this.screenName};$.get("/json-api/showAuthor?"+$.param(apiParams),function(data){callback(data)});this.contentRequested=true}},getStatscardContent:function(){if(!this.signupDateFormated){this.author.signup=moment(this.author.signup.split(" ")[0]).format("MMM Do YYYY");this.signupDateFormated=true}if(!this.countsFormatted){var viewCount=this.author.views,favoritesCount=this.author.favoritesCount;this.author.views=numeral(viewCount).format("0,0");this.author.favoritesCount=numeral(favoritesCount).format("0,0");this.countsFormatted=true}return this.template({data:this.author})},mouseInTrigger:function(e){var that=this;this.hovering=true;this.intentTimeout=setTimeout(function(){if(that.hovering){that.getPopover().show();that.fetchAuthor(function(data){that.author=data;that.author.following=typeof data.following!=="undefined"&&data.following;that.getPopover().destroy();that.createPopover({content:$.proxy(that.getStatscardContent,that),template:Ibles.JST["statscard-wrapper"]});that.showPopover();that.getPopoverContainer().hover($.proxy(that.mouseInPopover,that),$.proxy(that.mouseOut,that));that.enableFollowing()})}},250)},mouseInPopover:function(e){this.hovering=true},mouseOut:function(e){this.hovering=false;var that=this;clearTimeout(this.intentTimeout);clearTimeout(this.persistenceTimeout);this.persistenceTimeout=setTimeout(function(){if(!that.hovering){that.$element.popover("hide")}},500)},enableFollowing:function(){var that=this;this.getPopoverContainer().on("click",".follow-btn",function(e){var followBtn=$(e.currentTarget);followBtn.addClass("disabled");followBtn.children("span").html(Ibles.locale.uiElements.loading);$.ajax({url:"/json-api/"+(that.author.following?"unfollowAuthor":"followAuthor"),dataType:"json",type:"POST",data:{screenName:that.screenName}}).done(function(data){var isFollowing=data.isFollowing;that.author.following=isFollowing;if(isFollowing){that.author.followersCount++}else{that.author.followersCount--}}).fail(function(jqXHR,textStatus){if(jqXHR.status===401)window.location.href=that.loginURL}).complete(function(){followBtn.removeClass("disabled");followBtn.fadeOut(400,function(){followBtn.children("span").html(that.author.following?followBtn.data("followingtxt"):followBtn.data("followtxt"));followBtn.children(".bg-icon").removeClass("checkmarksmall plus").addClass(that.author.following?"checkmarksmall":"plus");followBtn.fadeIn(400)});var countContainer=followBtn.closest(".follow").find(".callout"),followCount=that.author.followersCount;countContainer.text(followCount)})})}};$.fn.statscard=function(option){return this.each(function(){var $this=$(this),data=$this.data("statscard"),options=typeof option=="object"&&option;if(!data)$this.data("statscard",data=new StatsCard(this,options))})};$.fn.statscard.Constructor=StatsCard})(window.jQuery,window._);!function(a,b,c,d){var e=a(b);a.fn.lazyload=function(f){function g(){var b=0;i.each(function(){var c=a(this);if(!j.skip_invisible||c.is(":visible"))if(a.abovethetop(this,j)||a.leftofbegin(this,j));else if(a.belowthefold(this,j)||a.rightoffold(this,j)){if(++b>j.failure_limit)return!1}else c.trigger("appear"),b=0})}var h,i=this,j={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:b,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return f&&(d!==f.failurelimit&&(f.failure_limit=f.failurelimit,delete f.failurelimit),d!==f.effectspeed&&(f.effect_speed=f.effectspeed,delete f.effectspeed),a.extend(j,f)),h=j.container===d||j.container===b?e:a(j.container),0===j.event.indexOf("scroll")&&h.bind(j.event,function(){return g()}),this.each(function(){var b=this,c=a(b);b.loaded=!1,(c.attr("src")===d||c.attr("src")===!1)&&c.is("img")&&c.attr("src",j.placeholder),c.one("appear",function(){if(!this.loaded){if(j.appear){var d=i.length;j.appear.call(b,d,j)}a("<img />").bind("load",function(){var d=c.attr("data-"+j.data_attribute);c.hide(),c.is("img")?c.attr("src",d):c.css("background-image","url('"+d+"')"),c[j.effect](j.effect_speed),b.loaded=!0;var e=a.grep(i,function(a){return!a.loaded});if(i=a(e),j.load){var f=i.length;j.load.call(b,f,j)}}).attr("src",c.attr("data-"+j.data_attribute))}}),0!==j.event.indexOf("scroll")&&c.bind(j.event,function(){b.loaded||c.trigger("appear")})}),e.bind("resize",function(){g()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&e.bind("pageshow",function(b){b.originalEvent&&b.originalEvent.persisted&&i.each(function(){a(this).trigger("appear")})}),a(c).ready(function(){g()}),this},a.belowthefold=function(c,f){var g;return g=f.container===d||f.container===b?(b.innerHeight?b.innerHeight:e.height())+e.scrollTop():a(f.container).offset().top+a(f.container).height(),g<=a(c).offset().top-f.threshold},a.rightoffold=function(c,f){var g;return g=f.container===d||f.container===b?e.width()+e.scrollLeft():a(f.container).offset().left+a(f.container).width(),g<=a(c).offset().left-f.threshold},a.abovethetop=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollTop():a(f.container).offset().top,g>=a(c).offset().top+f.threshold+a(c).height()},a.leftofbegin=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollLeft():a(f.container).offset().left,g>=a(c).offset().left+f.threshold+a(c).width()},a.inviewport=function(b,c){return!(a.rightoffold(b,c)||a.leftofbegin(b,c)||a.belowthefold(b,c)||a.abovethetop(b,c))},a.extend(a.expr[":"],{"below-the-fold":function(b){return a.belowthefold(b,{threshold:0})},"above-the-top":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-screen":function(b){return a.rightoffold(b,{threshold:0})},"left-of-screen":function(b){return!a.rightoffold(b,{threshold:0})},"in-viewport":function(b){return a.inviewport(b,{threshold:0})},"above-the-fold":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-fold":function(b){return a.rightoffold(b,{threshold:0})},"left-of-fold":function(b){return!a.rightoffold(b,{threshold:0})}})}(jQuery,window,document);Ibles.package("Ibles.views","Ibles.models","Ibles.collections");Ibles.models.CandidateContest=Backbone.Model.extend({defaults:{id:null,title:null,url:null,urlString:null,thumbUrl:null,squareUrl:null,onlyUS:false,pending:false,entered:false},initialize:function(options){this.set({url:Ibles.reverseUrls.contestDetailUrl(this.get("urlString")),squareUrl:this.get("thumbUrl")&&this.get("thumbUrl").replace("THUMB","SQUARE2")})},enteredContest:function(){return this.get("entered")||this.get("pending")},enterOrLeaveContest:function(){var self=this,action=this.enteredContest()?"REMOVE":"ADD";Ibles.API.contestAjaxRequest("enter",{contestId:this.get("id"),instructableId:this.collection.ibleId,posted:(new Date).getTime(),action:action},{success:function(){if(self.enteredContest()){self.set({entered:false,pending:false})}else{self.set({entered:false,pending:true})}}})}});Ibles.collections.CandidateContests=Backbone.Collection.extend({model:Ibles.models.CandidateContest,initialize:function(models,options){this.ibleId=options.ibleId;this.iblePublishDate=options.iblePublishDate;this.enteredContests=options.enteredContests;this.loadContests()},loadContests:function(){var self=this;$.when(this.addPendingContests(),this.addOpenedContests()).done(function(){self.addEnteredContests();self.trigger("doneLoadingContests")})},addEnteredContests:function(){var enteredContests=_.map(this.enteredContests,function(contest){contest.entered=true;return contest});this.add(enteredContests,{at:0,merge:true})},addPendingContests:function(){var self=this;return Ibles.API.getRequest("showInstructableUserData",{id:this.ibleId},{success:function(data){var pendingInContests=_.map(data.pendingInContests,function(contest){contest.pending=true;return contest});self.add(pendingInContests,{merge:true})}})},addOpenedContests:function(){var self=this,publishDate=moment(this.iblePublishDate);return Ibles.API.getRequest("getContests",{},{success:function(data){var openContests=_.filter(data.contests,function(contest){var startDate=moment(contest.startDate),deadline=moment(contest.deadline);if(contest.state==="open"){return Ibles.session.isAdmin()||startDate.isBefore(publishDate)&&deadline.isAfter(publishDate)}return false});self.add(openContests,{merge:true})}})}});Ibles.views.CandidateContestView=Backbone.View.extend({template:_.template(Ibles.JST["add-to-contest-modal-list-item"]),tagName:"li",events:{"click .add-btn":"toggleEnterContest","click .us-only-checkbox":"toggleUsResident","hover .add-btn":"enterHover"},initialize:function(){this.listenTo(this.model,"change:entered change:pending",this.changeEnteredStatus)},changeEnteredStatus:function(){var $button=this.$(".add-btn");if(this.model.get("pending")){$button.button("pending")}else if(this.model.get("entered")){$button.button("added")}else{$button.button("add")}$button.attr("disabled",false)},toggleEnterContest:function(e){e.preventDefault();$(e.currentTarget).button("loading");this.model.enterOrLeaveContest()},toggleUsResident:function(e){var $button=this.$(".add-btn"),doDisable=typeof disable==="undefined"&&$button.hasClass("disable")||disable===true;if(doDisable){$button.attr("disable","disabled")}else{$button.attr("disabled",false)}},enterHover:function(e){var $button=$(e.currentTarget);if(this.model.enteredContest()){if(e.type==="mouseenter"){$button.button("remove")}else if(e.type==="mouseleave"){if(this.model.get("pending"))$button.button("pending");else $button.button("added")}}},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});Ibles.views.AddToContestView=Backbone.View.extend({id:"add-to-contest-modal",className:"add-to-modal modal hide fade",template:_.template(Ibles.JST["add-to-contest-modal"]),initialize:function(options){var ibleData=options.ibleData;this.eligibleContests=new Ibles.collections.CandidateContests([],{ibleId:ibleData.id,iblePublishDate:ibleData.publishDate,enteredContests:ibleData.votableContests});this.listenTo(this.eligibleContests,"add",this.renderEligibleContest);this.listenToOnce(this.eligibleContests,"doneLoadingContests",this.renderContestList);$("body").append(this.$el);this.$el.html(this.template())},render:function(){this.$el.modal()},renderEligibleContest:function(contest){this.$(".eligible-contests").append(new Ibles.views.CandidateContestView({model:contest}).render().el)},renderContestList:function(){this.$(".loading").hide();if(this.eligibleContests.length>0){this.$(".eligible-contests").show()}else{this.$(".no-contests-msg").show()}}});Ibles.package("Ibles.views","Ibles.models");Ibles.models.CandidateGroup=Backbone.Model.extend({defaults:function(){return{id:null,title:null,path:null,url:null,addedDate:null,tinyUrl:null,smallUrl:null,groupCategories:[],categoryInGroup:"",added:false}},initialize:function(options){if(!_.isEmpty(this.get("groupId")))this.set("id",this.get("groupId"));if(!_.isEmpty(this.get("groupTitle")))this.set("title",this.get("groupTitle"));if(!_.isEmpty(this.get("path")))this.set("url",Ibles.reverseUrls.groupUrl(this.get("path")))},toggleAddToGroup:function(){var data={groupId:this.get("id"),groupCategory:this.get("categoryInGroup"),posted:(new Date).getTime()},self=this;data[this.get("added")?"removeId":"approveId"]=this.collection.ibleId;return $.ajax({url:"/group/addinstructable/",type:"POST",data:data,success:function(data){self.set({added:!self.get("added")})}})}});Ibles.collections.CandidateGroups=Backbone.Collection.extend({model:Ibles.models.CandidateGroup,initialize:function(models,options){this.ibleId=options.ibleId;this.groupsIbleBelongsTo=options.groupsIbleBelongsTo;this.loadGroups()},loadGroups:function(options){var self=this;$.when(this.addGroupsUserBelongsTo()).done(function(){self.addGroupsIbleBelongsTo();self.trigger("doneLoadingGroups")})},addGroupsIbleBelongsTo:function(){var self=this,groupsIbleBelongsTo=_.map(this.groupsIbleBelongsTo,function(group){self.normalizeGroupData(group);group.added=true;return group});groupsIbleBelongsTo=_.filter(groupsIbleBelongsTo,function(group){return!!self.get(group.id)});if(groupsIbleBelongsTo.length)this.add(groupsIbleBelongsTo,{merge:true})},addGroupsUserBelongsTo:function(){var self=this;return Ibles.API.getRequest("showAuthor",{},{success:function(data){if(data.groups&&data.groups.length){_.each(data.groups,self.normalizeGroupData);self.add(data.groups)}}})},normalizeGroupData:function(groupData){if(!_.isEmpty(groupData.groupId))groupData.id=groupData.groupId;if(!_.isEmpty(groupData.groupTitle))groupData.title=groupData.groupTitle;if(!_.isEmpty(groupData.path))groupData.url=Ibles.reverseUrls.groupUrl(groupData.path);return groupData}});Ibles.views.CandidateGroupView=Backbone.View.extend({template:_.template(Ibles.JST["add-to-group-modal-list-item"]),tagName:"li",events:{"click .add-btn":"toggleAddToGroup","change .group-categories-dropdown":"groupCategorySelected","hover .add-btn":"addHover"},initialize:function(){this.listenTo(this.model,"change:added",this.changeAddedStatus)},changeAddedStatus:function(){var $button=this.$(".add-btn");if(this.model.get("added")){$button.button("added")}else{$button.button("add")}$button.attr("disabled",false)},toggleAddToGroup:function(e){e.preventDefault();$(e.currentTarget).button("loading");this.model.toggleAddToGroup()},groupCategorySelected:function(e){this.model.set("categoryInGroup",$(e.currentTarget).val())},addHover:function(e){var $button=$(e.currentTarget);if(this.model.get("added")){if(e.type==="mouseenter"){$button.button("remove")}else if(e.type==="mouseleave"){$button.button("added")}}},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});Ibles.views.AddToGroupView=Backbone.View.extend({id:"add-to-group-modal",className:"add-to-modal modal hide fade",template:_.template(Ibles.JST["add-to-group-modal"]),initialize:function(options){var ibleData=options.ibleData;this.eligibleGroups=new Ibles.collections.CandidateGroups([],{ibleId:ibleData.id,groupsIbleBelongsTo:ibleData.groupsBelongedTo});this.listenTo(this.eligibleGroups,"add",this.renderEligibleGroup);this.listenToOnce(this.eligibleGroups,"doneLoadingGroups",this.renderGroupList);$("body").append(this.$el);this.$el.html(this.template())},render:function(){this.$el.modal()},renderEligibleGroup:function(group){this.$(".eligible-groups").append(new Ibles.views.CandidateGroupView({model:group}).render().el)},renderGroupList:function(){this.$(".loading").hide();if(this.eligibleGroups.length>0){this.$(".eligible-groups").show()}else{this.$(".no-groups-msg").show()}}});